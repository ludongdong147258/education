angular.module("education",["ngResource","ionic","ngFileUpload","monospaced.qrcode"]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,t,o){o.views.maxCache(5),o.templates.maxPrefetch(0),t.otherwise("/news"),e.state("login",{url:"/login",cache:!1,views:{baseContent:{templateUrl:"./js/login/login.html",controller:"LoginController"}}}).state("findpwd",{url:"/findpwd",cache:!1,views:{baseContent:{templateUrl:"./js/findpwd/findpwd.html",controller:"FindpwdController"}}}).state("teacher",{url:"/teacher",views:{baseContent:{templateUrl:"./js/teacher/teacher.html",controller:"TeacherController"}}}).state("teacherInfo",{url:"/teacher/info/{id}",cache:!1,views:{baseContent:{templateUrl:"./js/teacher/teacher-info.html",controller:"TeacherInfoController"}}}).state("teacherOrderHardWare",{url:"/teacher/orderHardWare",cache:!1,views:{baseContent:{templateUrl:"./js/teacher/order-hardware.html",controller:"TeacherOrderHardWareController"}}}).state("teacherDetails",{url:"/teacher/details/{id}",cache:!1,views:{baseContent:{templateUrl:"./js/teacher/teacher-details.html",controller:"TeacherDetailsController"}}}).state("news",{url:"/news",cache:!1,views:{baseContent:{templateUrl:"./js/news/news.html",controller:"NewsController"}}}).state("newsDetails",{url:"/news/details/{id}",cache:!1,views:{baseContent:{templateUrl:"./js/news/news-details.html",controller:"NewsDetailsController"}}}).state("register",{url:"/register?tabIndex",cache:!1,views:{baseContent:{templateUrl:"./js/register/register.html",controller:"RegisterController"}}}).state("studentInfo",{url:"/student/info",cache:!1,views:{baseContent:{templateUrl:"./js/student/student-info.html",controller:"StudentInfoController"}}}).state("studentOrderHardWare",{url:"/student/orderHardWare?id&name",cache:!1,views:{baseContent:{templateUrl:"./js/student/order-hardware.html",controller:"StudentOrderHardWareController"}}}).state("studentOrderDetails",{url:"/student/order/details?id",cache:!1,views:{baseContent:{templateUrl:"./js/student/order-details.html",controller:"StudentOrderDetailsController"}}}).state("reference",{url:"/reference",cache:!1,views:{baseContent:{templateUrl:"./js/reference/reference.html",controller:"ReferenceController"}}}).state("personal",{url:"/personal",cache:!1,views:{baseContent:{templateUrl:"./js/personal/personal.html",controller:"PersonalController"}}}).state("studentOrder",{url:"/student/order",cache:!1,views:{baseContent:{templateUrl:"./js/student/order.html",controller:"StudentOrderController"}}}).state("organizationInfo",{url:"/organization/info",cache:!1,views:{baseContent:{templateUrl:"./js/organization/info.html",controller:"OrganizationInfoController"}}}).state("organizationManager",{url:"/organization/manager",cache:!1,views:{baseContent:{templateUrl:"./js/organization/manager.html",controller:"OrganizationManagerController"}}}).state("organizationAddTeacher",{url:"/organization/addTeacher",cache:!1,views:{baseContent:{templateUrl:"./js/organization/add-teacher.html",controller:"OrganizationAddTeacherController"}}}).state("staffOrder",{url:"/staff/order",cache:!1,views:{baseContent:{templateUrl:"./js/staff/order.html",controller:"StaffOrderController"}}}).state("staffOrderService",{url:"/staff/order/create",cache:!1,views:{baseContent:{templateUrl:"./js/staff/order-service.html",controller:"StaffOrderServiceController"}}}).state("staffOrderDetails",{url:"/staff/order/details?id",cache:!1,views:{baseContent:{templateUrl:"./js/staff/order.details.html",controller:"StaffOrderDetailsController"}}}).state("examineList",{url:"/exmaine/list",cache:!1,views:{baseContent:{templateUrl:"./js/staff/examine.list.html",controller:"ExamineController"}}}).state("examineTeacher",{url:"/exmaine/teacher/{id}",cache:!1,views:{baseContent:{templateUrl:"./js/staff/teacher.details.html",controller:"ExamineTeacherController"}}}).state("examineOrganization",{url:"/exmaine/organization/{id}",cache:!1,views:{baseContent:{templateUrl:"./js/staff/organization.details.html",controller:"ExamineOrganizationController"}}}).state("search",{url:"/search?type",cache:!1,views:{baseContent:{templateUrl:"./js/search/search.html",controller:"SearchController"}}}).state("updatepwd",{url:"/updatepwd",cache:!1,views:{baseContent:{templateUrl:"./js/updatepwd/updatepwd.html",controller:"UpdatepwdController"}}}).state("recommend",{url:"/recommend",views:{baseContent:{templateUrl:"./js/recommend/recommend.html",controller:"RecommendController"}}}).state("organizationOrderHardWare",{url:"/organization/orderHardWare",views:{baseContent:{templateUrl:"./js/organization/order-hardware.html",controller:"InstitutionOrderHardWareController"}}})}]).controller("MainController",["$rootScope","$scope","$state","$ionicSideMenuDelegate","$ionicModal","$ionicPopup","$timeout","$ionicLoading","$ionicPopover",function(e,t,o,r,a,n,s,i,c){e.showMessage=function(e,t){t=t||1e3,i.show({template:e}),window.setTimeout(function(){i.hide()},t)},t.toggleRight=function(){r.toggleRight()},t.goToSearch=function(){o.go("search")},t.logout=function(){e.user=null,localStorage.removeItem("token"),localStorage.removeItem("user"),o.go("news")}}]).run(["$rootScope","$ionicLoading","CONFIG",function(e,t,o){e.$on("$stateChangeStart",function(e,o,r,a,n){t.show({template:'<ion-spinner icon="ios-small"></ion-spinner>'})}),e.$on("$stateChangeSuccess",function(e,o,r,a,n){t.hide()}),e.$on("$stateChangeError",function(e,o,r,a,n){t.hide()}),o.user&&(e.user=JSON.parse(o.user))}]).constant("CONFIG",{urlPrefix:"",token:localStorage.getItem("token"),user:localStorage.getItem("user"),student:"学生",teacher:"老师",institution:"机构",manage:"工作人员"}).directive("scrollHeight",["$window",function(e){return{restrict:"AE",link:function(t,o,r){o[0].style.height=e.innerHeight-44+"px",o.attr("scroll",!1)}}}]).factory("ValidateService",function(){var e={checkPwd:function(e){var t=/^[0-9 | A-Z | a-z]{6,10}$/;return t.test(e)},checkPhone:function(e){var t=/^1[0-9]{10}$/;return t.test(e)},checkSmsCode:function(e){var t=/^[0-9]{6}$/;return t.test(e)},checkAddress:function(e){var t=/^[0-9a-zA-Z\u4e00-\u9fa5]{5,30}$/;return t.test(e)},checkName:function(e){var t=/^[\u4e00-\u9fa5]{2,7}$/;return t.test(e)}};return e}),angular.module("education").filter("TypeFilter",["CONFIG",function(){return function(e){return CONFIG[e]}}]),angular.module("education").controller("FindpwdController",["$rootScope","$scope","$state","FindpwdService","$timeout","RegisterService","ValidateService",function(e,t,o,r,a,n,s){function i(){return t.count=l,0==l?(t.btnState=!1,void a(u)):(l--,void(u=a(i,1e3)))}e.showHeaderBar=!1,t.findpwdInfo={};var c={validateInput:function(){return t.findpwdInfo.mobile?s.checkPhone(t.findpwdInfo.mobile)?t.findpwdInfo.smscode?s.checkSmsCode(t.findpwdInfo.smscode)?t.findpwdInfo.password?!!s.checkPwd(t.findpwdInfo.password)||(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请输入新密码!"),!1):(e.showMessage("短信验证码格式不正确!"),!1):(e.showMessage("请输入验证码!"),!1):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("请输入手机号!"),!1)}},l=60,u=null;t.btnState=!1,t.count=l,t.back=function(){o.go("login")},t.saveNewPwd=function(){var n=c.validateInput();n&&r.saveNewPwd(t.findpwdInfo,function(t){"Y"==t.success&&(e.showMessage("保存成功!"),a(function(){o.go("login")},1e3))},function(t){e.showMessage("保存失败!")})},t.getSmsCode=function(){return t.findpwdInfo.mobile?s.checkPhone(t.findpwdInfo.mobile)?(t.btnState=!0,void n.getSmsCode({mobile:t.findpwdInfo.mobile},function(t){"Y"==t.success&&(i(),e.showMessage("验证码发送成功!"))},function(t){e.showMessage("验证码发送失败!"),console.log(t)})):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("请填写手机号!"),!1)}}]),angular.module("education").factory("FindpwdService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/findpassword",{},{saveNewPwd:{method:"post",headers:{token:t.token}}})}]),angular.module("education").controller("HomeController",["$rootScope","$scope","CONFIG","HomeService","StudentService","$state",function(e,t,o,r,a,n){if(e.showHeaderBar=!0,e.user)switch(e.user.role){case"student":t.listItems=[{state:"studentOrderHardWare",name:"预定智能硬件"},{state:"studentInfo",name:"补全学生资料"},{state:"reference",name:"邀请老师/同学加入"}];break;case"teacher":t.listItems=[{state:"teacherOrderHardWare",name:"预定智能硬件"},{state:"teacherInfo",name:"认证教师资料"},{state:"reference",name:"邀请老师/同学加入"}];break;case"institution":t.listItems=[{state:"teacherOrderHardWare",name:"预定智能硬件"},{state:"organizationInfo",name:"认证机构资料"},{state:"organizationManager",name:"管理机构教师"}];break;case"manage":t.listItems=[{state:"staffOrderService",name:"提交订单"},{state:"examineList",name:"审核教师/机构"}]}t.hasHardWare=function(t,o){"studentOrderHardWare"==t&&(o.preventDefault(),a.hasHardWare({},function(t){"Y"==t.success?e.showMessage("预定申请已受理,我们的工作人员将在您指定的日期电话联系您并上门为您安装智能硬件!",3e3):n.go("studentOrderHardWare")}))}}]),angular.module("education").factory("HomeService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/update",{},{getSelfInfo:{method:"post",headers:{token:t.token}}})}]),angular.module("education").controller("LoginController",["$rootScope","$scope","$state","LoginService","CONFIG","$ionicLoading","$timeout","ValidateService",function(e,t,o,r,a,n,s,i){e.showHeaderBar=!1;var c={validateInput:function(){return t.loginInfo.mobile?i.checkPhone(t.loginInfo.mobile)?t.loginInfo.password?!!i.checkPwd(t.loginInfo.password)||(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请输入密码!"),!1):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("请输入手机号!"),!1)}};t.loginInfo={type:"student"},t.back=function(){o.go("news")},t.login=function(){var i=c.validateInput();i&&(n.show({template:"登录中..."}),r.login(t.loginInfo,function(r){if("Y"==r.success){n.hide(),a.token=r.data.token,e.showMessage("登录成功!");var i=r.data.user;i.role=t.loginInfo.type,localStorage.setItem("token",r.data.token),localStorage.setItem("user",JSON.stringify(i)),a.user=i,e.user=i,s(function(){o.go("news",null,{reload:!0})},1e3)}else e.showMessage(r.msg)},function(t){n.hide(),e.showMessage("登录失败!")}))}}]),angular.module("education").factory("LoginService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/login",{},{login:{method:"post"}})}]),angular.module("education").controller("NewsController",["$rootScope","$scope","NewsService",function(e,t,o){t.showNewsList=!0,t.showOutcomeList=!1,t.newsList=[],t.hasMoreData=!0;var r=1,a="news",n={loadNews:function(){o.getNewsList({page:r,type:a},function(e){"Y"==e.success&&(t.newsList=t.newsList.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete"),e.data.length>0?t.hasMoreData=!0:t.hasMoreData=!1)},function(e){console.log(e)})}};if(n.loadNews(),t.changeTab=function(e){r=1,t.newsList.length=0,e?(t.showNewsList=!1,t.showOutcomeList=!0,a="achieved"):(t.showNewsList=!0,t.showOutcomeList=!1,a="news"),n.loadNews()},t.loadMore=function(){r++,n.loadNews()},t.refreshNews=function(){r=1,t.newsList.length=0,n.loadNews()},e.user)switch(e.user.role){case"student":e.listItems=[{state:"studentOrderHardWare",name:"预约智能硬件",class:"yuding-icon"}];break;case"teacher":e.listItems=[{state:"teacherOrderHardWare",name:"预约智能硬件",class:"yuding-icon"}];break;case"institution":e.listItems=[{state:"organizationOrderHardWare",name:"预约智能硬件",class:"yuding-icon"}];break;case"manage":e.listItems=[]}}]),angular.module("education").controller("NewsDetailsController",["$rootScope","$scope","$state","NewsService","$stateParams",function(e,t,o,r,a){e.showHeaderBar=!1,t.back=function(){o.go("news")},t.newsInfo={};var n={getNewsDetails:function(){r.getNewsDetails({id:a.id},function(e){"Y"==e.success&&(t.newsInfo=e.data)},function(e){console.error(e)})}};n.getNewsDetails()}]),angular.module("education").factory("NewsService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/news/lists",{},{getNewsList:{method:"get"},getNewsDetails:{method:"get",url:t.urlPrefix+"/v1/news/detail/:id"}})}]),angular.module("education").controller("OrganizationAddTeacherController",["$rootScope","$scope","$state","OrganizationService","$timeout","ValidateService",function(e,t,o,r,a,n){e.showHeaderBar=!1,t.back=function(){o.go("organizationManager")},t.teacherInfo={sex:1},t.addTeacher=function(){var n=s.validateInput();n&&r.addTeacher(t.teacherInfo,function(t){"Y"==t.success&&(e.showMessage("新增成功!"),a(function(){o.go("organizationManager")},1e3))},function(t){console.error(t),e.showMessage("新增失败!")})},t.changeSex=function(e){t.teacherInfo.sex=e};var s={validateInput:function(){return t.teacherInfo.truename?n.checkName(t.teacherInfo.truename)?t.teacherInfo.mobile?n.checkPhone(t.teacherInfo.mobile)?t.teacherInfo.password?!!n.checkPwd(t.teacherInfo.password)||(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("密码不能为空!"),!1):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("手机号码不能为空!"),!1):(e.showMessage("教师姓名2-7个中文字符!"),!1):(e.showMessage("教师姓名不能为空!"),!1)}}}]),angular.module("education").controller("InstitutionOrderHardWareController",["$rootScope","$scope","$state","$timeout","StudentService","ValidateService",function(e,t,o,r,a,n){t.city={key:"",id:""},t.province={key:""},t.back=function(){o.go("news")},t.saveOrder=function(){var n=i.validateInput();n&&(t.hardwareInfo.mobile||(t.hardwareInfo.mobile=parseInt(e.user.mobile)),t.hardwareInfo.address_id=t.city.id,t.hardwareInfo.member_type=e.user.role,a.orderHardWare(t.hardwareInfo,function(t){"Y"==t.success?(e.showMessage("预定申请已受理,我们的工作人员将在您指定的日期电话联系您并上门为您安装智能硬件!",5e3),r(function(){o.go("news")},3e3)):angular.isObject(t.msg)?angular.forEach(t.msg,function(o,r){e.showMessage(t.msg[r])}):e.showMessage("预定失败!")},function(t){console.error(t),e.showMessage("预定失败!")}))},t.hardwareInfo={recommend_type:1};var s=[];t.provinces=[],t.cities=[];var i={getAddressList:function(){a.getAddressList({},function(e){if("Y"==e.success){s=e.data;var o="";angular.forEach(e.data,function(e,r){o!=e.province&&(t.provinces.push({key:e.province}),o=e.province)})}},function(e){console.log(e)})},validateInput:function(){var o=t.hardwareInfo;return o.time?t.province.key?t.city.key?o.address_detail?n.checkAddress(o.address_detail)?o.link_name?n.checkName(o.link_name)?!(o.mobile&&!n.checkPhone(o.mobile))||(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("联系人姓名2-7位中文字符!"),!1):(e.showMessage("联系人姓名不能为空!"),!1):(e.showMessage("地址5-30个字符!"),!1):(e.showMessage("上门安装地址不能为空!"),!1):(e.showMessage("城市不能为空!"),!1):(e.showMessage("省份不能为空!"),!1):(e.showMessage("日期不能为空!"),!1)}};i.getAddressList(),t.changeProvince=function(e){t.province=e,t.cities=[],angular.forEach(s,function(o){o.province==e.key&&t.cities.push({key:o.city,id:o.id})})},t.changeCity=function(e){t.city=e}}]),angular.module("education").controller("OrganizationInfoController",["$rootScope","$scope","$state","OrganizationService","Upload","CONFIG","$timeout",function(e,t,o,r,a,n,s){e.showHeaderBar=!1,t.back=function(){o.go("personal")},t.dispalyStates=[!0,!1,!1],t.organizationInfo={},t.saveInfo=function(){r.updateOrganizationInfo(t.organizationInfo,function(t){"Y"==t.success&&e.showMessage("保存成功!")},function(t){e.showMessage("保存失败!"),console.error(t)})},t.tabChange=function(e){angular.forEach(t.dispalyStates,function(e,o){t.dispalyStates[o]=!1}),t.dispalyStates[e]=!0};var i={getOrganizationInfo:function(){r.getOrganizationInfo({},function(e){"Y"==e.success&&(t.organizationInfo=e.data,t.organizationInfo.certificate_url&&(t.f={},t.f.progress=100))},function(e){console.error(e)})}};i.getOrganizationInfo(),t.uploadFiles=function(e,o){t.f=e,t.errFile=o&&o[0],e&&(e.upload=a.upload({url:n.urlPrefix+"/v1/common/upload",data:{file:e}}),e.upload.then(function(e){s(function(){t.organizationInfo.certificate_url=e.data})},function(e){e.status>0&&(t.errorMsg=e.status+": "+e.data)},function(t){e.progress=Math.min(100,parseInt(100*t.loaded/t.total))}))}}]),angular.module("education").controller("OrganizationManagerController",["$rootScope","$scope","$state","OrganizationService","$ionicPopup",function(e,t,o,r,a){e.showHeaderBar=!1,t.back=function(){o.go("personal")},t.teacherList=[];var n={loadList:function(){r.getTeacherList({},function(e){"Y"==e.success&&(t.teacherList=e.data)},function(e){console.error(e)})}};n.loadList(),t.deleteTeacher=function(o,n){var s=a.confirm({title:"删除",template:"您确定要删除吗？",okText:"确定",cancelText:"取消",okType:"button-energized",cancelType:"button-dark"});s.then(function(a){a&&r.deleteTeacher({teacher_id:o},function(o){"Y"==o.success?(t.teacherList.splice(n,1),e.showMessage("删除成功!")):e.showMessage("删除失败!")},function(e){console.error(e)})})}}]),angular.module("education").factory("OrganizationService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/institution/teachers",{},{getTeacherList:{method:"get",headers:{token:t.token}},deleteTeacher:{url:t.urlPrefix+"/v1/institution/delteacher",method:"post",headers:{token:t.token}},addTeacher:{url:t.urlPrefix+"/v1/institution/addteacher",method:"post",headers:{token:t.token}},updateOrganizationInfo:{url:t.urlPrefix+"/v1/institution/update",method:"post",headers:{token:t.token}},getOrganizationInfo:{url:t.urlPrefix+"/v1/account/detail",method:"get",headers:{token:t.token}}})}]),angular.module("education").controller("PersonalController",["$rootScope","$scope","$state","CONFIG",function(e,t,o,r){if(e.showHeaderBar=!1,t.back=function(){o.go("news")},e.user){e.user.avatar||(e.user.avatar="././images/person.png");var a=e.user.role;switch(t.roleDisplay=r[a],a){case"student":t.listItems=[{state:"studentInfo",class:"ion-person calm",name:"我的资料"},{state:"studentOrder",class:"ion-ios-list energized",name:"我的订单"},{state:"reference",class:"ion-star assertive",name:"我的推荐"}];break;case"teacher":t.listItems=[{state:"teacherInfo",class:"ion-person calm",name:"我的资料"},{state:"reference",class:"ion-star assertive",name:"我的推荐"}];break;case"institution":t.listItems=["organizationInfo"],t.listItems=[{state:"organizationInfo",class:"ion-person calm",name:"我的资料"},{state:"organizationManager",class:"ion-ios-people assertive",name:"机构教师管理"}];break;case"manage":t.listItems=[{state:"staffOrder",class:"ion-ios-list energized",name:"我的订单"},{state:"staffOrderService",class:"ion-ios-list-outline calm",name:"服务订单提交"},{state:"examineList",class:"ion-ios-people positive",name:"机构/教师审核"}]}}}]),angular.module("education").controller("RecommendController",["$rootScope","$scope","$state","$stateParams","SearchService",function(e,t,o,r,a){t.back=function(){o.go("news")},t.recommendList=[];var n={init:function(){n.loadList()},loadList:function(){a.getRecommendTeacherList({},function(e){if("Y"==e.success){e.data.stars=[];for(var o=0;o<e.data.star;o++)e.data.stars.push(o);t.recommendList=e.data}},function(e){console.error(e)})}};n.init()}]),angular.module("education").controller("ReferenceController",["$rootScope","$scope","$state","ReferenceService","CONFIG",function(e,t,o,r,a){var n=localStorage.getItem("code");t.back=function(){o.go("personal")},t.displayStates=[!0,!1],t.invitedList=[],t.tabChange=function(e){angular.forEach(t.displayStates,function(e,o){t.displayStates[o]=!1}),t.displayStates[e]=!0,e&&s.loadList()};var s={loadList:function(){r.getInvitedList({},function(e){"Y"==e.success&&(t.invitedList=e.data)},function(e){console.error(e)})}},i="/src/#/register";n&&(i+="?code="+n),t.qrcodeInfo={link:a.urlPrefix+i,v:5,e:"M",s:200}}]),angular.module("education").factory("ReferenceService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/inviterecord/lists",{},{getInvitedList:{method:"get",headers:{token:t.token}}})}]),angular.module("education").controller("RegisterController",["$rootScope","$scope","$state","$stateParams","RegisterService","LoginService","$timeout","CONFIG","ValidateService",function(e,t,o,r,a,n,s,i,c){function l(){return t.counts[f]=h[f],0==h[f]?(t.btnStates[f]=!1,void s(g)):(h[f]--,void(g=s(l,1e3)))}var u={validateInput:function(o){return t.registerInfo[o].mobile?c.checkPhone(t.registerInfo[o].mobile)?t.registerInfo[o].smscode?c.checkSmsCode(t.registerInfo[o].smscode)?t.registerInfo[o].password?!!c.checkPwd(t.registerInfo[o].password)||(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请填写密码!"),!1):(e.showMessage("短信验证码格式不正确!"),!1):(e.showMessage("请填写短信验证码!"),!1):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("请填写手机号!"),!1)}},d=r.tabIndex,f=0,h=[60,60,60],g=null,p=["student","teacher","institution"];t.btnStates=[!1,!1,!1],t.counts=[h[0],h[1],h[2]],t.registerInfo={student:{type:p[0]},teacher:{type:p[1]},institution:{type:p[2]}},t.back=function(){o.go("news")},t.displayStates=[!0,!1,!1],t.tabChange=function(e){angular.forEach(t.displayStates,function(e,o){t.displayStates[o]=!1}),t.displayStates[e]=!0,f=e},d&&t.tabChange(d),t.submitRegisterInfo=function(){var r=p[f],n=u.validateInput(r);n&&a.register(t.registerInfo[r],function(t){if("Y"==t.success){i.token=t.data.token;var a=t.data.user;a.role=r,a.invite_code&&localStorage.setItem("code",a.invite_code),localStorage.setItem("token",t.data.token),localStorage.setItem("user",JSON.stringify(a)),i.user=a,e.user=a,e.showMessage("注册成功!"),o.go("news",null,{reload:!0})}else if("N"==t.success)for(var n in t.msg)e.showMessage(t.msg[n])},function(t){e.showMessage("注册失败!")})},t.getSmsCode=function(){return t.registerInfo[p[f]].mobile?c.checkPhone(t.registerInfo[p[f]].mobile)?(t.btnStates[f]=!0,void a.getSmsCode({mobile:t.registerInfo[p[f]].mobile},function(t){"Y"==t.success&&(l(),e.showMessage("验证码发送成功!"))},function(t){e.showMessage("验证码发送失败!"),console.log(t)})):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("请填写手机号!"),!1)}}]),angular.module("education").factory("RegisterService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/regist",{},{register:{method:"post"},getSmsCode:{method:"post",url:t.urlPrefix+"/v1/account/sms"}})}]),angular.module("education").controller("SearchController",["$rootScope","$scope","$state","$stateParams","SearchService","TeacherService",function(e,t,o,r,a,n){t.type=r.type,t.back=function(){t.type?o.go("studentOrderHardWare"):o.go("news")};var s={page:1};t.recommendList=[],t.teacherList=[],t.searchText="",t.showHistory=!0,t.histories=[];var i=/^[0-9]+$/,c={init:function(){c.getHistoryList()},loadList:function(){a.getRecommendTeacherList({},function(e){if("Y"==e.success){e.data.stars=[];for(var o=0;o<e.data.star;o++)e.data.stars.push(o);t.recommendList=e.data}},function(e){console.error(e)})},loadTeacherList:function(){var e=t.searchText;e&&(t.showHistory=!1,i.test(e)?s.mobile=e:s.truename=e,n.getTeacherList(s,function(o){if("Y"==o.success){t.histories.indexOf(e)==-1&&(t.histories.push(e),localStorage.setItem("records",t.histories)),o.data.stars=[];for(var r=0;r<o.data.star;r++)o.data.stars.push(r);t.teacherList=t.teacherList.concat(o.data),t.$broadcast("scroll.infiniteScrollComplete"),o.data.length>0?t.hasMoreData=!0:t.hasMoreData=!1}},function(e){console.log(e)}))},getHistoryList:function(){var e=localStorage.getItem("records");e&&(e.indexOf(",")!=-1?t.histories=e.split(","):t.histories.push(e))}};c.init(),t.search=function(){return t.searchText?(s={page:1},t.teacherList.length=0,void c.loadTeacherList()):void e.showMessage("搜索关键字不能为空!")},t.loadMore=function(){s.page++,c.loadTeacherList()},t.refresh=function(){s.page=1,t.teacherList.length=0,c.loadTeacherList()},t.textChange=function(){t.searchText||(t.showHistory=!0,c.getHistoryList())},t.clearHistory=function(){localStorage.removeItem("records"),t.histories.length=0},t.setSearchText=function(e){t.searchText=e,t.search()},t.toStudentHardWare=function(e,t){e.preventDefault(),e.stopPropagation(),o.go("studentOrderHardWare",{id:t.id,name:t.truename})}}]),angular.module("education").factory("SearchService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/teacher/recommend",{},{getRecommendTeacherList:{method:"get"}})}]),angular.module("education").controller("ExamineController",["$rootScope","$scope","StaffService","$state",function(e,t,o,r){e.showHeaderBar=!1,t.showTeacherList=!0,t.showOrganizationList=!1,t.back=function(){r.go("personal")},t.teacherList=[],t.organizationList=[];var a={loadTeacherList:function(){o.getTeacherList({},function(e){"Y"==e.success&&(t.teacherList=e.data)},function(e){console.log(e)})},loadOrganizationList:function(){o.getOrganizationList({},function(e){"Y"==e.success&&(t.organizationList=e.data)},function(e){console.log(e)})}};a.loadTeacherList(),t.changeTab=function(e){e?(t.showTeacherList=!1,t.showOrganizationList=!0,a.loadOrganizationList()):(t.showTeacherList=!0,t.showOrganizationList=!1,a.loadTeacherList())}}]),angular.module("education").controller("StaffOrderController",["$rootScope","$scope","$state","$ionicPopup","StaffService",function(e,t,o,r,a){e.showHeaderBar=!1,t.back=function(){o.go("personal")},t.displayStates=[!0,!1],t.tabChange=function(e){angular.forEach(t.displayStates,function(e,o){t.displayStates[o]=!1}),t.displayStates[e]=!0,e?n.getServiceList():n.getEquipmentList()},t.showConfirm=function(e,o){if("待上门安装"==e.status){r.show({template:"硬件安装完成后<br/>请将状态更改为[已完成安装]<br/>如果客户取消安装<br/>请将状态更改为[客户取消]",title:"更改智能硬件上门安装状态",scope:t,buttons:[{text:"已完成安装",type:"button-energized",onTap:function(t){a.updateEquipmentStatus({id:e.id,status:2},function(e){"Y"==e.success&&n.getEquipmentList()},function(e){console.error(e)})}},{text:"客户取消",type:"button-energized",onTap:function(t){a.updateEquipmentStatus({id:e.id,status:3},function(e){"Y"==e.success&&n.getEquipmentList()},function(e){console.error(e)})}},{text:"关闭",type:"button-dark"}]})}};var n={getServiceList:function(){a.getServiceList({},function(e){"Y"==e.success&&(t.serviceList=e.data)},function(e){console.error(e)})},getEquipmentList:function(){a.getEquipmentList({},function(e){"Y"==e.success&&(t.equipmentList=e.data)},function(e){console.error(e)})}};n.getEquipmentList()}]),angular.module("education").controller("StaffOrderDetailsController",["$rootScope","$scope","$state","$ionicPopup","$stateParams","StaffService","$timeout",function(e,t,o,r,a,n,s){t.back=function(){o.go("staffOrder")},t.dispalyStates=[!0,!1,!1],t.tabChange=function(e){angular.forEach(t.dispalyStates,function(e,o){t.dispalyStates[o]=!1}),t.dispalyStates[e]=!0};var i={getOrderDetails:function(){n.getOrderDetails({id:a.id},function(e){if("Y"==e.success){var e=e.data;"1"==e.status?e.statusDisplay="待支付":"2"==e.status&&(e.statusDisplay="已支付"),t.orderInfo=e}})}};i.getOrderDetails(),t.confirm=function(){var t=r.confirm({title:"提示",template:"您确定已收款?",cancelText:"取消",cancelType:"button-dark",okText:"确定",okType:"button-energized"});t.then(function(t){t&&n.authOrder({id:a.id,status:2},function(t){"Y"==t.success&&(e.showMessage("收款成功!"),s(function(){o.go("staffOrder")},1e3))})})}}]),angular.module("education").controller("StaffOrderServiceController",["$rootScope","$scope","$state","$ionicPopup","StaffService","$timeout","ValidateService",function(e,t,o,r,a,n,s){var i={getStaticFee:function(){a.getStaticFee({},function(e){"Y"==e.success&&(t.feeInfo=e.data)})}};i.getStaticFee(),t.getTeacherFee=function(){return t.serviceInfo.mobile?s.checkPhone(t.serviceInfo.mobile)?void a.getTeacherFee({mobile:t.serviceInfo.mobile},function(e){"Y"==e.success&&(t.teacherFee=parseFloat(e.data.extra_server_fee))}):void e.showMessage("手机号码格式不正确!"):void e.showMessage("手机号不能为空!")},t.back=function(){o.go("personal")},t.teacherFee=0,t.displayStates=[!0,!1],t.serviceInfo={manage_id:e.user.id,total_fee:0,status:1,equipment:1,homework_server:3,prepare_server:0,extra_server:0},t.createOrder=function(){return t.serviceInfo.mobile?s.checkPhone(t.serviceInfo.mobile)?void r.show({template:"1、智能硬件免费提供给使用者使用,采取押金方式提供;<br/>2、3个月内,硬件没有大的人为损害,使用者无条件自由退换押金;<br/>3、使用者长期使用期间,硬件产品的换代升级,提供新的硬件产品,为全免费置换模式;使用者无需另行支付或增加押金额;<br/>4、使用满1年后,使用者不再有硬件使用需求,在硬件产品没有大的人为损害情况下,且硬件产品具备使用条件,使用者可申请退换押金;<br/>5、智能硬件产品实行三年质保,终生保修(质保指由于质量缺陷造成的设备无法正常使用)过程中产生邮寄或路程费用由使用者承担。如因使用或保管不当原因导致产品出现以下情况，包括但不限于主板或芯片损坏、零部件损坏、烧坏、外观破损、人为损坏、或擅自拆装等现象，不属于质保范围;",title:"智能硬件产品质保及押金使用模式说明",cssClass:"service-popup",scope:t,buttons:[{text:"取消",type:"button-dark"},{text:"确认并同意协议",type:"button-energized",onTap:function(r){var s=t.serviceInfo,i=t.feeInfo;s.total_fee=i.equipment_fee*s.equipment+i.homework_fee*s.homework_server+i.prepare_fee*s.prepare_server+t.teacherFee*s.extra_server,a.orderService(t.serviceInfo,function(t){"Y"==t.success&&(e.showMessage("订单生成成功!"),n(function(){o.go("staffOrderDetails",{id:t.data.id})},1e3))})}}]}):void e.showMessage("手机号码格式不正确!"):void e.showMessage("手机号不能为空!")},t.changeFDYPrice=function(e){t.serviceInfo.equipment=e,e?t.displayStates=[!0,!1]:t.displayStates=[!1,!0]},t.changeZYPrice=function(o){var r=t.serviceInfo.homework_server;o?r+=o:r>3?r-=1:e.showMessage("不能少于3个月!"),t.serviceInfo.homework_server=r},t.changeFYPrice=function(o){var r=t.serviceInfo.prepare_server;o?r+=o:r>0?r-=1:e.showMessage("不能少于0个月!"),t.serviceInfo.prepare_server=r},t.changeBYPrice=function(o){var r=t.serviceInfo.extra_server;o?r+=o:r>0?r-=1:e.showMessage("不能少于0小时!"),t.serviceInfo.extra_server=r}}]),angular.module("education").controller("ExamineOrganizationController",["$rootScope","$scope","StaffService","$state","$stateParams","$ionicPopup","$timeout",function(e,t,o,r,a,n,s){e.showHeaderBar=!1,t.back=function(){r.go("examineList")};var i={getDetails:function(){o.getOrganizationDetails({id:a.id},function(e){"Y"==e.success&&(t.organizationInfo=e.data)},function(e){console.error(e)})}};i.getDetails(),t.pass=function(){var t=n.confirm({title:"审核",template:"您确定通过审核？",okText:"确定",cancelText:"取消",okType:"button-energized",cancelType:"button-dark"});t.then(function(t){t&&o.authOrganization({id:a.id},function(t){"Y"==t.success&&(e.showMessage("审核成功!"),s(function(){r.go("examineList")},1e3))},function(t){e.showMessage("审核失败!")})})}}]),angular.module("education").factory("StaffService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/news/lists",{},{getNewsList:{method:"get"},getNewsDetails:{method:"get",url:t.urlPrefix+"/v1/news/detail/:id"},getTeacherList:{method:"get",url:t.urlPrefix+"/v1/teacher/unauth/lists",headers:{token:t.token}},getOrganizationList:{method:"get",url:t.urlPrefix+"/v1/institution/unauth/lists",headers:{token:t.token}},authTeacher:{method:"post",url:t.urlPrefix+"/v1/manage/auth/teacher",headers:{token:t.token}},authOrganization:{method:"post",url:t.urlPrefix+"/v1/manage/auth/institution",headers:{token:t.token}},getOrganizationDetails:{method:"get",url:t.urlPrefix+"/v1/institution/detail/:id",headers:{token:t.token}},orderService:{method:"post",url:t.urlPrefix+"/v1/order/server/add",headers:{token:t.token}},getServiceList:{method:"get",url:t.urlPrefix+"/v1/order/server/lists",headers:{token:t.token}},getEquipmentList:{method:"get",url:t.urlPrefix+"/v1/order/equipment/lists",headers:{token:t.token}},updateEquipmentStatus:{method:"post",url:t.urlPrefix+"/v1/order/equipment/auth",headers:{token:t.token}},getOrderDetails:{method:"get",url:t.urlPrefix+"/v1/order/server/detail",headers:{token:t.token}},getStaticFee:{method:"get",url:t.urlPrefix+"/v1/order/static/fee",headers:{token:t.token}},getTeacherFee:{method:"get",url:t.urlPrefix+"/v1/order/teacher/fee",headers:{token:t.token}},authOrder:{method:"post",url:t.urlPrefix+"/v1/order/server/auth",headers:{token:t.token}}})}]),angular.module("education").controller("ExamineTeacherController",["$rootScope","$scope","StaffService","$state","$stateParams","TeacherService","$ionicPopup","$timeout",function(e,t,o,r,a,n,s,i){t.back=function(){r.go("examineList")};var c={},l={},u={},d={getDetails:function(){n.getDetails({id:a.id},function(e){if("Y"==e.success){t.teacherInfo=e.data;var o=[];t.teacherInfo.grades&&angular.forEach(t.teacherInfo.grades,function(e){o.push(c[e])}),t.teacherInfo.grades=o.join("、");var r=[];t.teacherInfo.subjects&&angular.forEach(t.teacherInfo.subjects,function(e){r.push(l[e])}),t.teacherInfo.subjects=r.join("、"),t.teacherInfo.grades=o.join("、");var a=[];t.teacherInfo.work_time&&angular.forEach(t.teacherInfo.work_time,function(e){a.push(u[e])}),t.teacherInfo.work_time=a.join("、")}},function(e){console.error(e)})},getGrades:function(){n.getGrades({},function(e){"Y"==e.success&&(c=e.data)},function(e){console.error(e)});
},getSubjects:function(){n.getSubjects({},function(e){"Y"==e.success&&(l=e.subjects)},function(e){console.error(e)})},getTimes:function(){n.getTimes({},function(e){"Y"==e.success&&(u=e.workTime)},function(e){console.error(e)})}};d.getGrades(),d.getSubjects(),d.getTimes(),d.getDetails(),t.pass=function(){var t=s.confirm({title:"审核",template:"您确定通过审核？",okText:"确定",cancelText:"取消",okType:"button-energized",cancelType:"button-dark"});t.then(function(t){t&&o.authTeacher({id:a.id},function(t){"Y"==t.success&&(e.showMessage("审核成功!"),i(function(){r.go("examineList")},1e3))},function(t){e.showMessage("审核失败!")})})}}]),angular.module("education").controller("StudentOrderController",["$rootScope","$scope","$state","StudentService",function(e,t,o,r){e.showHeaderBar=!1,t.back=function(){o.go("personal")};var a={getOrderList:function(){r.getOrderList({},function(e){"Y"==e.success&&(t.orderList=e.data)})}};a.getOrderList()}]),angular.module("education").controller("StudentOrderDetailsController",["$rootScope","$scope","$state","$stateParams","StudentService",function(e,t,o,r,a){t.back=function(){o.go("studentOrder")},t.dispalyStates=[!0,!1],t.tabChange=function(e){angular.forEach(t.dispalyStates,function(e,o){t.dispalyStates[o]=!1}),t.dispalyStates[e]=!0};var n={getOrderInfo:function(){a.getOrderDetails({id:r.id},function(e){if("Y"==e.success){var e=e.data;"1"==e.status?e.statusDisplay="待支付":"2"==e.status&&(e.statusDisplay="已支付"),t.orderInfo=e}})}};n.getOrderInfo()}]),angular.module("education").controller("StudentOrderHardWareController",["$rootScope","$scope","$state","StudentService","$stateParams","$timeout",function(e,t,o,r,a,n){t.back=function(){localStorage.removeItem("hardwareInfo"),o.go("news")},t.hardwareInfo={recommend_type:1},t.displayStates=[!0,!1];var s=a.id;s&&(t.name=a.name,t.hardwareInfo.recommend_type=2,t.displayStates=[!1,!0]),t.saveOrder=function(){var a=c.validateInput();a&&(t.hardwareInfo.mobile||(t.hardwareInfo.mobile=parseInt(e.user.mobile)),t.hardwareInfo.address_id=t.city.id,t.hardwareInfo.member_type=e.user.role,s&&(t.hardwareInfo.teacher_id=s),r.orderHardWare(t.hardwareInfo,function(t){"Y"==t.success?(localStorage.removeItem("hardwareInfo"),e.showMessage("预定申请已受理,我们的工作人员将在您指定的日期电话联系您并上门为您安装智能硬件!",5e3),n(function(){o.go("news")},3e3)):angular.forEach(t.msg,function(o,r){e.showMessage(t.msg[r])})},function(t){console.error(t),e.showMessage("预定失败!")}))};var i=[];t.provinces=[],t.cities=[];var c={getAddressList:function(){r.getAddressList({},function(e){if("Y"==e.success){i=e.data;var o="";angular.forEach(e.data,function(e,r){o!=e.province&&(t.provinces.push({key:e.province}),o=e.province)});var r=localStorage.getItem("hardwareInfo");r?(t.hardwareInfo=angular.fromJson(r),angular.forEach(t.provinces,function(e,o){if(e.key==t.hardwareInfo.province.key)return void(t.province=t.provinces[o])}),t.changeProvince(t.province),angular.forEach(t.cities,function(e,o){if(e.key==t.hardwareInfo.city.key)return void(t.city=t.cities[o])}),t.hardwareInfo.time=new Date(t.hardwareInfo.time)):(t.province={key:""},t.city={key:"",id:""})}},function(e){console.log(e)})},validateInput:function(){var o=t.hardwareInfo;return o.time?t.province.key?t.city.key?o.address_detail?o.link_name?!(2==t.hardwareInfo.recommend_type&&!t.name)||(e.showMessage("所选老师不能为空!"),!1):(e.showMessage("联系人姓名不能为空!"),!1):(e.showMessage("上门安装地址不能为空!"),!1):(e.showMessage("城市不能为空!"),!1):(e.showMessage("省份不能为空!"),!1):(e.showMessage("日期不能为空!"),!1)}};c.getAddressList(),t.changeProvince=function(e){t.province=e,t.cities=[],angular.forEach(i,function(o){o.province==e.key&&t.cities.push({key:o.city,id:o.id})})},t.changeCity=function(e){t.city=e},t.changeType=function(e){t.hardwareInfo.recommend_type=e,1==e?t.displayStates=[!0,!1]:(t.displayStates=[!1,!0],o.go("search",{type:"student"}),t.hardwareInfo.province=t.province,t.hardwareInfo.city=t.city,localStorage.setItem("hardwareInfo",JSON.stringify(t.hardwareInfo)))}}]),angular.module("education").controller("StudentInfoController",["$rootScope","$scope","$state","StudentService","$timeout","ValidateService",function(e,t,o,r,a,n){t.back=function(){o.go("personal")},t.states=[],t.grades=[],t.saveInfo=function(){var o=s.validateInput();o&&r.updatePersonalInfo(t.personalInfo,function(t){"Y"==t.success&&e.showMessage("保存成功!")},function(e){console.error(e)})},t.personalInfo={};var s={getPersonalInfo:function(){r.getPersonalInfo({},function(e){if("Y"==e.success){var e=e.data;e.age&&(e.age=parseInt(e.age)),t.personalInfo=e,t.personalInfo.state&&angular.forEach(t.personalInfo.state,function(e){angular.forEach(t.states,function(t){t.key==e&&(t.isSelected=!0)})})}},function(e){console.error(e)})},getStates:function(){r.getStates({},function(e){"Y"==e.success&&angular.forEach(e.data,function(e,o){t.states.push({key:o,val:e,isSelected:!1})})},function(e){console.error(e)})},getGrades:function(){r.getGrades({},function(e){"Y"==e.success&&angular.forEach(e.data,function(e,o){t.grades.push({key:o,val:e})})},function(e){console.error(e)})},validateInput:function(){return t.personalInfo.truename?n.checkName(t.personalInfo.truename)?t.personalInfo.age?t.personalInfo.age<8||t.personalInfo.age>20?(e.showMessage("年龄8-20岁!"),!1):!!t.personalInfo.school_name||(e.showMessage("学校不能为空!"),!1):(e.showMessage("年龄不能为空!"),!1):(e.showMessage("姓名2-7个中文字符!"),!1):(e.showMessage("姓名不能为空!"),!1)}};t.changeSex=function(e){t.personalInfo.sex=e},t.changeGrade=function(e){t.personalInfo.grade=e},t.changeState=function(e){var o=t.personalInfo.state;o||(o=[]);var r=o.indexOf(e.key);e.isSelected=!e.isSelected,r==-1&&e.isSelected?o.push(e.key):o.splice(r,1),t.personalInfo.state=o},s.getGrades(),s.getStates(),s.getPersonalInfo()}]),angular.module("education").factory("StudentService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/detail",{},{getPersonalInfo:{method:"get",headers:{token:t.token}},updatePersonalInfo:{method:"post",url:t.urlPrefix+"/v1/account/update",headers:{token:t.token}},getStates:{url:t.urlPrefix+"/v1/student/state",method:"get"},getGrades:{url:t.urlPrefix+"/v1/student/grades",method:"get"},getAddressList:{url:t.urlPrefix+"/v1/address/lists",method:"get"},orderHardWare:{url:t.urlPrefix+"/v1/order/equipment/add",method:"post",headers:{token:t.token}},hasHardWare:{url:t.urlPrefix+"/v1/order/equipment/has",method:"get",headers:{token:t.token}},getOrderList:{url:t.urlPrefix+"/v1/order/server/lists",method:"get",headers:{token:t.token}},getOrderDetails:{method:"get",url:t.urlPrefix+"/v1/order/server/detail",headers:{token:t.token}}})}]).factory("HardWareService",function(){var e={setTeaherInfo:function(e,t){this.teacherId=e,this.name=t},getTeacherInfo:function(){return{teacherId:this.teacherId,name:this.name}}};return e}),angular.module("education").controller("TeacherOrderHardWareController",["$rootScope","$scope","$state","$timeout","StudentService","ValidateService",function(e,t,o,r,a,n){t.back=function(){o.go("news")},t.saveOrder=function(){var n=i.validateInput();n&&(t.hardwareInfo.mobile||(t.hardwareInfo.mobile=parseInt(e.user.mobile)),t.hardwareInfo.address_id=t.city.id,t.hardwareInfo.member_type=e.user.role,a.orderHardWare(t.hardwareInfo,function(t){"Y"==t.success?(e.showMessage("预定申请已受理,我们的工作人员将在您指定的日期电话联系您并上门为您安装智能硬件!",5e3),r(function(){o.go("news")},3e3)):angular.forEach(t.msg,function(o,r){e.showMessage(t.msg[r])})},function(t){console.error(t),e.showMessage("预定失败!")}))},t.hardwareInfo={recommend_type:1},t.city={key:"",id:""},t.province={key:""};var s=[];t.provinces=[],t.cities=[];var i={getAddressList:function(){a.getAddressList({},function(e){if("Y"==e.success){s=e.data;var o="";angular.forEach(e.data,function(e,r){o!=e.province&&(t.provinces.push({key:e.province}),o=e.province)})}},function(e){console.log(e)})},validateInput:function(){var o=t.hardwareInfo;return o.time?t.province.key?t.city.key?o.address_detail?n.checkAddress(o.address_detail)?o.link_name?n.checkName(o.link_name)?!(o.mobile&&!n.checkPhone(o.mobile))||(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("联系人姓名2-7位中文字符!"),!1):(e.showMessage("联系人姓名不能为空!"),!1):(e.showMessage("地址5-30个字符!"),!1):(e.showMessage("上门安装地址不能为空!"),!1):(e.showMessage("城市不能为空!"),!1):(e.showMessage("省份不能为空!"),!1):(e.showMessage("日期不能为空!"),!1)}};i.getAddressList(),t.changeProvince=function(e){t.province=e,t.cities=[],angular.forEach(s,function(o){o.province==e.key&&t.cities.push({key:o.city,id:o.id})})},t.changeCity=function(e){t.city=e}}]),angular.module("education").controller("TeacherController",["$rootScope","$scope","TeacherService","$stateParams","$state",function(e,t,o,r,a){t.back=function(){a.go("news")},t.teacherList=[],t.subjects=[],t.subject={key:""},t.schoolworks=[],t.schoolwork={key:""},t.grades=[],t.grade={key:""},t.hasMoreData=!0;var n={page:1},s={init:function(){s.getSchoolworks(),s.getGrades(),s.getSubjects(),s.loadList({page:n.page})},loadList:function(){o.getTeacherList(n,function(e){if("Y"==e.success){e.data.stars=[];for(var o=0;o<e.data.star;o++)e.data.stars.push(o);t.teacherList=t.teacherList.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete"),e.data.length>0?t.hasMoreData=!0:t.hasMoreData=!1}},function(e){console.log(e)})},getSubjects:function(){o.getSubjects({},function(e){"Y"==e.success&&angular.forEach(e.subjects,function(e,o){t.subjects.push({key:o,val:e})})},function(e){console.log(e)})},getSchoolworks:function(){o.getSchoolworks({},function(e){"Y"==e.success&&angular.forEach(e.schoolwork,function(e,o){t.schoolworks.push({key:o,val:e})})},function(e){console.log(e)})},getGrades:function(){o.getGrades({},function(e){"Y"==e.success&&angular.forEach(e.data,function(e,o){t.grades.push({key:o,val:e})})},function(e){console.log(e)})}};s.init(),t.loadMore=function(){n.page++,s.loadList()},t.refresh=function(){n.page=1,t.teacherList.length=0,s.loadList()},t.changeGrade=function(e){n.page=1,t.teacherList.length=0,e?n.grade=e.key:n.grade="",s.loadList()},t.changeSubject=function(e){n.page=1,t.teacherList.length=0,e?n.subject=e.key:n.subject="",s.loadList()},t.changeSchoolwork=function(e){n.page=1,t.teacherList.length=0,e?n.schoolwork=e.key:n.schoolwork="",s.loadList()}}]),angular.module("education").controller("TeacherDetailsController",["$rootScope","$scope","$state","TeacherService","$stateParams",function(e,t,o,r,a){e.showHeaderBar=!1,t.back=function(){window.history.back()},t.teacherInfo={};var n={getDetails:function(){r.getDetails({id:a.id},function(e){if("Y"==e.success){t.teacherInfo=e.data,t.teacherInfo.stars=[];for(var o=0;o<e.data.star;o++)t.teacherInfo.stars.push(o)}},function(e){console.error(e)})}};n.getDetails()}]),angular.module("education").controller("TeacherInfoController",["$rootScope","$scope","$state","TeacherService","Upload","$stateParams","CONFIG","$timeout","ValidateService",function(e,t,o,r,a,n,s,i,c){t.appTitle="我的资料",n.id&&(t.appTitle="机构教师资料编辑"),t.back=function(){n.id?o.go("organizationManager"):o.go("personal")},t.dispalyStates=[!0,!1,!1],t.grades=[],t.worktimes=[],t.subjects=[],t.saveInfo=function(){var o=l.validateInput();o&&r.updatePersonalInfo(t.personalInfo,function(t){"Y"==t.success&&e.showMessage("保存成功!")},function(e){console.error(e)})},t.personalInfo={};var l={getTeacherInfo:function(){var e=this;r.getDetails({id:n.id},function(o){"Y"==o.success&&(t.personalInfo=o.data,e.handleTeacherInfo(t.personalInfo))},function(e){console.error(e)})},getPersonalInfo:function(){var e=this;r.getPersonalInfo({},function(o){"Y"==o.success&&(t.personalInfo=o.data,e.handleTeacherInfo(t.personalInfo))},function(e){console.error(e)})},handleTeacherInfo:function(e){var o=this;e.bankcard&&(e.bankcard=Number(e.bankcard)),e.age&&(e.age=Number(e.age)),e.worked_year&&(e.worked_year=Number(e.worked_year)),e.extra_server_fee&&(e.extra_server_fee=parseFloat(e.extra_server_fee)),e.certificate_url&&(t.f={},t.f.progress=100),o.setGrades(e.grades),o.setSubjects(e.subjects),o.setTimes(e.work_time)},getGrades:function(){r.getGrades({},function(e){"Y"==e.success&&angular.forEach(e.data,function(e,o){t.grades.push({key:o,val:e,isSelected:!1})})},function(e){console.error(e)})},getTimes:function(){r.getTimes({},function(e){"Y"==e.success&&angular.forEach(e.workTime,function(e,o){t.worktimes.push({key:o,val:e,isSelected:!1})})},function(e){console.error(e)})},getSubjects:function(){r.getSubjects({},function(e){"Y"==e.success&&angular.forEach(e.subjects,function(e,o){t.subjects.push({key:o,val:e,isSelected:!1})})},function(e){console.error(e)})},setGrades:function(e){e&&angular.forEach(e,function(e){angular.forEach(t.grades,function(t){t.key==e&&(t.isSelected=!0)})})},setSubjects:function(e){e&&angular.forEach(e,function(e){angular.forEach(t.subjects,function(t){t.key==e&&(t.isSelected=!0)})})},setTimes:function(e){e&&angular.forEach(e,function(e){angular.forEach(t.worktimes,function(t){t.key==e&&(t.isSelected=!0)})})},validateInput:function(){return t.personalInfo.truename?c.checkName(t.personalInfo.truename)?t.personalInfo.age?t.personalInfo.age<20||t.personalInfo.age>60?(e.showMessage("年龄20-60!"),!1):void 0:(e.showMessage("年龄不能为空!"),!1):(e.showMessage("姓名2-7个字符!"),!1):(e.showMessage("姓名不能为空!"),!1)}};t.changeSex=function(e){t.personalInfo.sex=e},t.changeGrade=function(e){angular.isArray(t.personalInfo.grades)||(t.personalInfo.grades=[]);var o=t.personalInfo.grades.indexOf(e.key),r=t.personalInfo.grades;e.isSelected=!e.isSelected,r||(r=[]),o==-1&&e.isSelected?r.push(e.key):r.splice(o,1)},t.changeSubject=function(e){angular.isArray(t.personalInfo.subjects)||(t.personalInfo.subjects=[]);var o=t.personalInfo.subjects.indexOf(e.key),r=t.personalInfo.subjects;e.isSelected=!e.isSelected,r||(r=[]),o==-1&&e.isSelected?r.push(e.key):r.splice(o,1)},t.changeTime=function(e){angular.isArray(t.personalInfo.work_time)||(t.personalInfo.work_time=[]);var o=t.personalInfo.work_time.indexOf(e.key),r=t.personalInfo.work_time;e.isSelected=!e.isSelected,r||(r=[]),o==-1&&e.isSelected?r.push(e.key):r.splice(o,1)},l.getGrades(),l.getTimes(),l.getSubjects(),n.id?l.getTeacherInfo():l.getPersonalInfo(),t.tabChange=function(e){angular.forEach(t.dispalyStates,function(e,o){t.dispalyStates[o]=!1}),t.dispalyStates[e]=!0},t.uploadFiles=function(e,o){t.f=e,t.errFile=o&&o[0],e&&(e.upload=a.upload({url:s.urlPrefix+"/v1/common/upload",data:{file:e}}),e.upload.then(function(e){i(function(){t.personalInfo.certificate_url=e.data})},function(e){e.status>0&&(t.errorMsg=e.status+": "+e.data)},function(t){e.progress=Math.min(100,parseInt(100*t.loaded/t.total))}))}}]),angular.module("education").factory("TeacherService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/detail",{},{getPersonalInfo:{method:"get",headers:{token:t.token}},updatePersonalInfo:{method:"post",url:t.urlPrefix+"/v1/teacher/update",headers:{token:t.token}},getTimes:{url:t.urlPrefix+"/v1/common/teacher/worktime",method:"get"},getGrades:{url:t.urlPrefix+"/v1/student/grades",method:"get"},getSubjects:{url:t.urlPrefix+"/v1/common/subjects",method:"get"},getSchoolworks:{url:t.urlPrefix+"/v1/common/schoolwork",method:"get"},getTeacherList:{url:t.urlPrefix+"/v1/teacher/lists",method:"get"},getDetails:{url:t.urlPrefix+"/v1/teacher/detail/:id",method:"get",headers:{token:t.token}},getRecommendTeacherList:{url:t.urlPrefix+"/v1/teacher/recommend",method:"get"}})}]),angular.module("education").controller("UpdatepwdController",["$rootScope","$scope","$state","UpdatepwdService","$timeout","ValidateService",function(e,t,o,r,a,n){e.showHeaderBar=!1,t.pwdInfo={},t.back=function(){o.go("personal")};var s={validateInput:function(){var o=t.pwdInfo;return o.password?n.checkPwd(o.password)?o.pwd1?n.checkPwd(o.pwd1)?o.pwd2?n.checkPwd(o.pwd2)?o.pwd1==o.pwd2||(e.showMessage("两次输入的密码不一致,请重新输入!"),!1):(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请设置新密码!"),!1):(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请输入新密码!"),!1):(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请输入原密码!"),!1)}};t.updatePwd=function(){var n=s.validateInput();if(n){var i={password:t.pwdInfo.password,newpassword:t.pwdInfo.pwd2};r.updatePwd(i,function(t){"Y"==t.success?(e.showMessage("修改成功!"),a(function(){o.go("personal")},1e3)):angular.isObject(t.msg)?angular.forEach(t.msg,function(t,o){e.showMessage(t)}):e.showMessage(t.msg)},function(t){console.error(t),e.showMessage("修改失败!")})}}}]),angular.module("education").factory("UpdatepwdService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/updatepassword",{},{updatePwd:{method:"post",headers:{token:t.token}}})}]);