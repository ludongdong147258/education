angular.module("education",["ngResource","ionic","ngFileUpload","monospaced.qrcode"]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,t,o){o.views.maxCache(5),o.templates.maxPrefetch(0),t.otherwise("/login"),e.state("login",{url:"/login",cache:!1,views:{baseContent:{templateUrl:"./js/login/login.html",controller:"LoginController"}}}).state("findpwd",{url:"/findpwd",cache:!1,views:{baseContent:{templateUrl:"./js/findpwd/findpwd.html",controller:"FindpwdController"}}}).state("teacher",{url:"/teacher",views:{baseContent:{templateUrl:"./js/teacher/teacher.html",controller:"TeacherController"}}}).state("teacherInfo",{url:"/teacher/info/{id}",cache:!1,views:{baseContent:{templateUrl:"./js/teacher/teacher-info.html",controller:"TeacherInfoController"}}}).state("teacherOrderHardWare",{url:"/teacher/orderHardWare",cache:!1,views:{baseContent:{templateUrl:"./js/teacher/order-hardware.html",controller:"TeacherOrderHardWareController"}}}).state("teacherDetails",{url:"/teacher/details/{id}?type&searchText",cache:!1,views:{baseContent:{templateUrl:"./js/teacher/teacher-details.html",controller:"TeacherDetailsController"}}}).state("news",{url:"/news?tabIndex",cache:!1,views:{baseContent:{templateUrl:"./js/news/news.html",controller:"NewsController"}}}).state("newsDetails",{url:"/news/details/{id}?tabIndex",cache:!1,views:{baseContent:{templateUrl:"./js/news/news-details.html",controller:"NewsDetailsController"}}}).state("register",{url:"/register?tabIndex&code",cache:!1,views:{baseContent:{templateUrl:"./js/register/register.html",controller:"RegisterController"}}}).state("studentInfo",{url:"/student/info",cache:!1,views:{baseContent:{templateUrl:"./js/student/student-info.html",controller:"StudentInfoController"}}}).state("studentOrderHardWare",{url:"/student/orderHardWare?id&name",cache:!1,views:{baseContent:{templateUrl:"./js/student/order-hardware.html",controller:"StudentOrderHardWareController"}}}).state("studentOrderDetails",{url:"/student/order/details?id",cache:!1,views:{baseContent:{templateUrl:"./js/student/order-details.html",controller:"StudentOrderDetailsController"}}}).state("reference",{url:"/reference",cache:!1,views:{baseContent:{templateUrl:"./js/reference/reference.html",controller:"ReferenceController"}}}).state("personal",{url:"/personal",cache:!1,views:{baseContent:{templateUrl:"./js/personal/personal.html",controller:"PersonalController"}}}).state("studentOrder",{url:"/student/order",cache:!1,views:{baseContent:{templateUrl:"./js/student/order.html",controller:"StudentOrderController"}}}).state("organizationInfo",{url:"/organization/info",cache:!1,views:{baseContent:{templateUrl:"./js/organization/info.html",controller:"OrganizationInfoController"}}}).state("organizationManager",{url:"/organization/manager",cache:!1,views:{baseContent:{templateUrl:"./js/organization/manager.html",controller:"OrganizationManagerController"}}}).state("organizationAddTeacher",{url:"/organization/addTeacher",cache:!1,views:{baseContent:{templateUrl:"./js/organization/add-teacher.html",controller:"OrganizationAddTeacherController"}}}).state("staffOrder",{url:"/staff/order?tabIndex",cache:!1,views:{baseContent:{templateUrl:"./js/staff/order.html",controller:"StaffOrderController"}}}).state("staffOrderService",{url:"/staff/order/create",cache:!1,views:{baseContent:{templateUrl:"./js/staff/order-service.html",controller:"StaffOrderServiceController"}}}).state("staffOrderDetails",{url:"/staff/order/details?id&tabIndex",cache:!1,views:{baseContent:{templateUrl:"./js/staff/order.details.html",controller:"StaffOrderDetailsController"}}}).state("examineList",{url:"/exmaine/list?tabIndex",cache:!1,views:{baseContent:{templateUrl:"./js/staff/examine.list.html",controller:"ExamineController"}}}).state("examineTeacher",{url:"/exmaine/teacher/{id}",cache:!1,views:{baseContent:{templateUrl:"./js/staff/teacher.details.html",controller:"ExamineTeacherController"}}}).state("examineOrganization",{url:"/exmaine/organization/{id}?tabIndex",cache:!1,views:{baseContent:{templateUrl:"./js/staff/organization.details.html",controller:"ExamineOrganizationController"}}}).state("search",{url:"/search?type&searchText",cache:!1,views:{baseContent:{templateUrl:"./js/search/search.html",controller:"SearchController"}}}).state("updatepwd",{url:"/updatepwd",cache:!1,views:{baseContent:{templateUrl:"./js/updatepwd/updatepwd.html",controller:"UpdatepwdController"}}}).state("recommend",{url:"/recommend",views:{baseContent:{templateUrl:"./js/recommend/recommend.html",controller:"RecommendController"}}}).state("organizationOrderHardWare",{url:"/organization/orderHardWare",views:{baseContent:{templateUrl:"./js/organization/order-hardware.html",controller:"InstitutionOrderHardWareController"}}})}]).controller("MainController",["$rootScope","$scope","$state","$ionicSideMenuDelegate","$ionicModal","$ionicPopup","$timeout","$ionicLoading","$ionicPopover",function(e,t,o,a,n,r,s,i,c){e.showMessage=function(e,t){t=t||1e3,i.show({template:e}),window.setTimeout(function(){i.hide()},t)},t.toggleRight=function(){a.toggleRight()},t.goToSearch=function(){o.go("search")},t.logout=function(){e.user=null,localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("records"),o.go("login")}}]).run(["$rootScope","$ionicLoading","CONFIG","$state",function(e,t,o,a){o.user&&(e.user=JSON.parse(o.user)),e.$on("$stateChangeStart",function(e,o,a,n,r){t.show({template:'<ion-spinner icon="ios-small"></ion-spinner>&nbsp;载入中...'})}),e.$on("$stateChangeSuccess",function(e,o,a,n,r){t.hide()}),e.$on("$stateChangeError",function(e,o,a,n,r){t.hide()})}]).constant("CONFIG",{urlPrefix:"http://101.200.131.30:8020",token:localStorage.getItem("token"),user:localStorage.getItem("user"),student:"学生",teacher:"老师",institution:"机构",manage:"工作人员"}).directive("scrollHeight",["$window",function(e){return{restrict:"AE",link:function(t,o,a){o[0].style.height=e.innerHeight-44+"px",o.attr("scroll",!1)}}}]).factory("ValidateService",function(){var e={checkPwd:function(e){var t=/^[0-9 | A-Z | a-z]{6,10}$/;return t.test(e)},checkPhone:function(e){var t=/^1[0-9]{10}$/;return t.test(e)},checkSmsCode:function(e){var t=/^[0-9]{6}$/;return t.test(e)},checkAddress:function(e){var t=/^[0-9a-zA-Z\u4e00-\u9fa5]{5,30}$/;return t.test(e)},checkName:function(e){var t=/^[\u4e00-\u9fa5]{2,7}$/;return t.test(e)}};return e}),angular.module("education").filter("TypeFilter",[function(){return function(e){switch(e){case"student":return"学生";case"teacher":return"老师";case"institution":return"机构";case"manage":return"工作人员"}}}]),angular.module("education").controller("FindpwdController",["$rootScope","$scope","$state","FindpwdService","$timeout","RegisterService","ValidateService",function(e,t,o,a,n,r,s){function i(){return t.count=l,0==l?(t.btnState=!1,void n(u)):(l--,void(u=n(i,1e3)))}e.showHeaderBar=!1,t.findpwdInfo={};var c={validateInput:function(){return t.findpwdInfo.mobile?s.checkPhone(t.findpwdInfo.mobile)?t.findpwdInfo.smscode?s.checkSmsCode(t.findpwdInfo.smscode)?t.findpwdInfo.password?!!s.checkPwd(t.findpwdInfo.password)||(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请输入新密码!"),!1):(e.showMessage("短信验证码格式不正确!"),!1):(e.showMessage("请输入验证码!"),!1):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("请输入手机号!"),!1)}},l=60,u=null;t.btnState=!1,t.count=l,t.back=function(){o.go("login")},t.saveNewPwd=function(){var r=c.validateInput();r&&a.saveNewPwd(t.findpwdInfo,function(t){"Y"==t.success&&(e.showMessage("保存成功!"),n(function(){o.go("login")},1e3))},function(t){e.showMessage("保存失败!")})},t.getSmsCode=function(){return t.findpwdInfo.mobile?s.checkPhone(t.findpwdInfo.mobile)?(t.btnState=!0,void r.getSmsCode({mobile:t.findpwdInfo.mobile},function(t){"Y"==t.success&&(i(),e.showMessage("验证码发送成功!"))},function(t){e.showMessage("验证码发送失败!"),console.log(t)})):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("请填写手机号!"),!1)}}]),angular.module("education").factory("FindpwdService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/findpassword",{},{saveNewPwd:{method:"post",headers:{token:t.token}}})}]),angular.module("education").controller("HomeController",["$rootScope","$scope","CONFIG","HomeService","StudentService","$state",function(e,t,o,a,n,r){if(e.showHeaderBar=!0,e.user)switch(e.user.role){case"student":t.listItems=[{state:"studentOrderHardWare",name:"预定智能硬件"},{state:"studentInfo",name:"补全学生资料"},{state:"reference",name:"邀请老师/同学加入"}];break;case"teacher":t.listItems=[{state:"teacherOrderHardWare",name:"预定智能硬件"},{state:"teacherInfo",name:"认证教师资料"},{state:"reference",name:"邀请老师/同学加入"}];break;case"institution":t.listItems=[{state:"teacherOrderHardWare",name:"预定智能硬件"},{state:"organizationInfo",name:"认证机构资料"},{state:"organizationManager",name:"管理机构教师"}];break;case"manage":t.listItems=[{state:"staffOrderService",name:"提交订单"},{state:"examineList",name:"审核教师/机构"}]}t.hasHardWare=function(t,o){"studentOrderHardWare"==t&&(o.preventDefault(),n.hasHardWare({},function(t){"Y"==t.success?e.showMessage("预定申请已受理,我们的工作人员将在您指定的日期电话联系您并上门为您安装智能硬件!",3e3):r.go("studentOrderHardWare")}))}}]),angular.module("education").factory("HomeService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/update",{},{getSelfInfo:{method:"post",headers:{token:t.token}}})}]),angular.module("education").controller("LoginController",["$rootScope","$scope","$state","LoginService","CONFIG","$ionicLoading","$timeout","ValidateService",function(e,t,o,a,n,r,s,i){e.user&&o.go("personal",null,{reload:!0});var c={validateInput:function(){return t.loginInfo.mobile?i.checkPhone(t.loginInfo.mobile)?t.loginInfo.password?!!i.checkPwd(t.loginInfo.password)||(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请输入密码!"),!1):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("请输入手机号!"),!1)}};t.loginInfo={type:"student"},t.back=function(){},t.login=function(){var i=c.validateInput();i&&(r.show({template:'<ion-spinner icon="ios-small"></ion-spinner>&nbsp;登录中...'}),a.login(t.loginInfo,function(a){if("Y"==a.success){r.hide(),n.token=a.data.token,e.showMessage("登录成功!");var i=a.data.user;i.role=t.loginInfo.type,localStorage.setItem("token",a.data.token),localStorage.setItem("user",JSON.stringify(i)),n.user=i,e.user=i,s(function(){o.go("personal",null,{reload:!0})},1e3)}else r.hide(),e.showMessage(a.msg)},function(t){r.hide(),e.showMessage("登录失败!")}))}}]),angular.module("education").factory("LoginService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/login",{},{login:{method:"post"}})}]),angular.module("education").controller("NewsController",["$rootScope","$scope","NewsService","$stateParams",function(e,t,o,a){var n=a.tabIndex;t.showNewsList=!0,t.showOutcomeList=!1,t.newsList=[],t.hasMoreData=!0,n&&(t.showNewsList=!1,t.showOutcomeList=!0);var r=1,s="news",i={loadNews:function(){o.getNewsList({page:r,type:s},function(e){"Y"==e.success&&(t.newsList=t.newsList.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete"),e.data.length>0?t.hasMoreData=!0:t.hasMoreData=!1)},function(e){console.log(e)})}};i.loadNews(),t.changeTab=function(e){r=1,t.newsList.length=0,e?(t.showNewsList=!1,t.showOutcomeList=!0,s="achieved"):(t.showNewsList=!0,t.showOutcomeList=!1,s="news"),i.loadNews()},t.loadMore=function(){r++,i.loadNews()},t.refreshNews=function(){r=1,t.newsList.length=0,i.loadNews()}}]),angular.module("education").controller("NewsDetailsController",["$rootScope","$scope","$state","NewsService","$stateParams",function(e,t,o,a,n){var r=n.tabIndex;t.back=function(){o.go("news",{tabIndex:r})},t.newsInfo={};var s={getNewsDetails:function(){a.getNewsDetails({id:n.id},function(e){"Y"==e.success&&(t.newsInfo=e.data)},function(e){console.error(e)})}};s.getNewsDetails()}]),angular.module("education").factory("NewsService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/news/lists",{},{getNewsList:{method:"get"},getNewsDetails:{method:"get",url:t.urlPrefix+"/v1/news/detail/:id"}})}]),angular.module("education").controller("OrganizationAddTeacherController",["$rootScope","$scope","$state","OrganizationService","$timeout","ValidateService",function(e,t,o,a,n,r){e.showHeaderBar=!1,t.back=function(){o.go("organizationManager")},t.teacherInfo={sex:1},t.addTeacher=function(){var r=s.validateInput();r&&a.addTeacher(t.teacherInfo,function(t){"Y"==t.success&&(e.showMessage("新增成功!"),n(function(){o.go("organizationManager")},1e3))},function(t){console.error(t),e.showMessage("新增失败!")})},t.changeSex=function(e){t.teacherInfo.sex=e};var s={validateInput:function(){return t.teacherInfo.truename?r.checkName(t.teacherInfo.truename)?t.teacherInfo.mobile?r.checkPhone(t.teacherInfo.mobile)?t.teacherInfo.password?!!r.checkPwd(t.teacherInfo.password)||(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("密码不能为空!"),!1):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("手机号码不能为空!"),!1):(e.showMessage("教师姓名2-7个中文字符!"),!1):(e.showMessage("教师姓名不能为空!"),!1)}}}]),angular.module("education").controller("InstitutionOrderHardWareController",["$rootScope","$scope","$state","$timeout","StudentService","ValidateService",function(e,t,o,a,n,r){t.city={key:"",id:""},t.province={key:""},t.back=function(){o.go("personal")},t.saveOrder=function(){var r=i.validateInput();r&&(t.hardwareInfo.mobile||(t.hardwareInfo.mobile=parseInt(e.user.mobile)),t.hardwareInfo.address_id=t.city.id,t.hardwareInfo.member_type=e.user.role,n.orderHardWare(t.hardwareInfo,function(t){"Y"==t.success?(e.showMessage("预定申请已受理,我们的工作人员将在您指定的日期电话联系您并上门为您安装智能硬件!",5e3),a(function(){o.go("personal")},3e3)):angular.isObject(t.msg)?angular.forEach(t.msg,function(o,a){e.showMessage(t.msg[a])}):e.showMessage("预定失败!")},function(t){console.error(t),e.showMessage("预定失败!")}))},t.hardwareInfo={recommend_type:1};var s=[];t.provinces=[],t.cities=[];var i={getAddressList:function(){n.getAddressList({},function(e){if("Y"==e.success){s=e.data;var o="";angular.forEach(e.data,function(e,a){o!=e.province&&(t.provinces.push({key:e.province}),o=e.province)})}},function(e){console.log(e)})},validateInput:function(){var o=t.hardwareInfo;return o.time?t.province.key?t.city.key?o.address_detail?r.checkAddress(o.address_detail)?o.link_name?r.checkName(o.link_name)?!(o.mobile&&!r.checkPhone(o.mobile))||(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("联系人姓名2-7位中文字符!"),!1):(e.showMessage("联系人姓名不能为空!"),!1):(e.showMessage("地址5-30个字符!"),!1):(e.showMessage("上门安装地址不能为空!"),!1):(e.showMessage("城市不能为空!"),!1):(e.showMessage("省份不能为空!"),!1):(e.showMessage("日期不能为空!"),!1)}};i.getAddressList(),t.changeProvince=function(e){t.province=e,t.cities=[],angular.forEach(s,function(o){o.province==e.key&&t.cities.push({key:o.city,id:o.id})})},t.changeCity=function(e){t.city=e}}]),angular.module("education").controller("OrganizationInfoController",["$rootScope","$scope","$state","OrganizationService","Upload","CONFIG","$timeout","ValidateService","$ionicLoading",function(e,t,o,a,n,r,s,i,c){e.showHeaderBar=!1,t.back=function(){o.go("personal")},t.dispalyStates=[!0,!1,!1],t.organizationInfo={},t.saveInfo=function(){var n=l.validateInput();n&&a.updateOrganizationInfo(t.organizationInfo,function(t){"Y"==t.success&&(e.showMessage("保存成功!"),s(function(){o.go("personal")},1e3))},function(t){e.showMessage("保存失败!"),console.error(t)})},t.tabChange=function(e){angular.forEach(t.dispalyStates,function(e,o){t.dispalyStates[o]=!1}),t.dispalyStates[e]=!0};var l={getOrganizationInfo:function(){a.getOrganizationInfo({},function(e){"Y"==e.success&&(t.organizationInfo=e.data,t.organizationInfo.certificate_url&&(t.f={},t.f.progress=100))},function(e){console.error(e)})},validateInput:function(){var o=t.organizationInfo;return o.name?o.legal_person?i.checkName(o.legal_person)?!!o.certificate_url||(e.showMessage("请上传企业营业执照照片!"),!1):(e.showMessage("法人姓名2-7个中文字符!"),!1):(e.showMessage("法人姓名不能为空!"),!1):(e.showMessage("机构名称不能为空!"),!1)}};l.getOrganizationInfo(),t.uploadFiles=function(o,a){t.f=o,t.errFile=a&&a[0],o&&(c.show({template:'<ion-spinner icon="ios-small"></ion-spinner>&nbsp;上传中...'}),o.upload=n.upload({url:r.urlPrefix+"/v1/common/upload",data:{file:o}}),o.upload.then(function(o){s(function(){c.hide(),e.showMessage("上传成功!"),t.organizationInfo.certificate_url=o.data})},function(o){o.status>0&&(c.hide(),e.showMessage("上传失败!"),t.errorMsg=o.status+": "+o.data)},function(e){o.progress=Math.min(100,parseInt(100*e.loaded/e.total))}))}}]),angular.module("education").controller("OrganizationManagerController",["$rootScope","$scope","$state","OrganizationService","$ionicPopup",function(e,t,o,a,n){e.showHeaderBar=!1,t.back=function(){o.go("personal")},t.teacherList=[];var r={loadList:function(){a.getTeacherList({},function(e){"Y"==e.success&&(t.teacherList=e.data)},function(e){console.error(e)})}};r.loadList(),t.deleteTeacher=function(o,r){var s=n.confirm({title:"删除",template:"您确定要删除吗？",okText:"确定",cancelText:"取消",okType:"button-energized",cancelType:"button-dark"});s.then(function(n){n&&a.deleteTeacher({teacher_id:o},function(o){"Y"==o.success?(t.teacherList.splice(r,1),e.showMessage("删除成功!")):e.showMessage("删除失败!")},function(e){console.error(e)})})}}]),angular.module("education").factory("OrganizationService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/institution/teachers",{},{getTeacherList:{method:"get",headers:{token:t.token}},deleteTeacher:{url:t.urlPrefix+"/v1/institution/delteacher",method:"post",headers:{token:t.token}},addTeacher:{url:t.urlPrefix+"/v1/institution/addteacher",method:"post",headers:{token:t.token}},updateOrganizationInfo:{url:t.urlPrefix+"/v1/institution/update",method:"post",headers:{token:t.token}},getOrganizationInfo:{url:t.urlPrefix+"/v1/account/detail",method:"get",headers:{token:t.token}}})}]),angular.module("education").controller("PersonalController",["$rootScope","$scope","$state","CONFIG","Upload","$timeout","StudentService","$ionicLoading","TeacherService","OrganizationService","StaffService",function(e,t,o,a,n,r,s,i,c,l,u){var d=e.user.role;if(t.back=function(){o.go("news")},t.uploadFiles=function(o,f){t.f=o,t.errFile=f&&f[0],o&&(i.show({template:'<ion-spinner icon="ios-small"></ion-spinner>&nbsp;上传中...'}),o.upload=n.upload({url:a.urlPrefix+"/v1/common/upload",data:{file:o}}),o.upload.then(function(t){r(function(){e.user.avatar=t.data;var o=JSON.stringify(e.user);"student"==d?s.updatePersonalInfo({avatar:t.data,id:e.user.id},function(t){"Y"==t.success&&(i.hide(),e.showMessage("上传成功!"),localStorage.setItem("user",o))},function(t){console.error(t),i.hide(),e.showMessage("上传失败!")}):"teacher"==d?c.updatePersonalInfo({avatar:t.data,id:e.user.id},function(t){"Y"==t.success&&(i.hide(),e.showMessage("上传成功!"),localStorage.setItem("user",o))},function(t){i.hide(),e.showMessage("上传失败!")}):"institution"==d?l.updateOrganizationInfo({avatar:t.data,id:e.user.id},function(t){"Y"==t.success&&(i.hide(),e.showMessage("上传成功!"),localStorage.setItem("user",o))},function(t){i.hide(),e.showMessage("上传失败!")}):"manage"==d&&u.updateAvatar({avatar:t.data,id:e.user.id},function(t){"Y"==t.success&&(i.hide(),e.showMessage("上传成功!"),localStorage.setItem("user",o))},function(t){i.hide(),e.showMessage("上传失败!")})})},function(o){o.status>0&&(t.errorMsg=o.status+": "+o.data,i.hide(),e.showMessage("上传失败!"))},function(e){o.progress=Math.min(100,parseInt(100*e.loaded/e.total))}))},e.user)switch(e.user.avatar||(e.user.avatar="././images/person.png"),t.roleDisplay=a[d],d){case"student":t.listItems=[{state:"studentOrderHardWare",class:"ion-clock balanced",name:"预约智能硬件"},{state:"studentInfo",class:"ion-person calm",name:"我的资料"},{state:"studentOrder",class:"ion-ios-list energized",name:"我的订单"},{state:"reference",class:"ion-star assertive",name:"我的推荐"}];break;case"teacher":t.listItems=[{state:"teacherOrderHardWare",class:"ion-clock balanced",name:"预约智能硬件"},{state:"teacherInfo",class:"ion-person calm",name:"我的资料"},{state:"reference",class:"ion-star assertive",name:"我的推荐"}];break;case"institution":t.listItems=[{state:"organizationOrderHardWare",class:"ion-clock balanced",name:"预约智能硬件"},{state:"organizationInfo",class:"ion-person calm",name:"我的资料"},{state:"organizationManager",class:"ion-ios-people assertive",name:"机构教师管理"}];break;case"manage":t.listItems=[{state:"staffOrder",class:"ion-ios-list energized",name:"我的订单"},{state:"staffOrderService",class:"ion-ios-list-outline calm",name:"服务订单提交"},{state:"examineList",class:"ion-ios-people positive",name:"机构/教师审核"}]}}]),angular.module("education").controller("RecommendController",["$rootScope","$scope","$state","$stateParams","SearchService",function(e,t,o,a,n){t.back=function(){o.go("news")}}]),angular.module("education").controller("ReferenceController",["$rootScope","$scope","$state","ReferenceService","CONFIG",function(e,t,o,a,n){var r=localStorage.getItem("code");t.back=function(){o.go("personal")},t.displayStates=[!0,!1],t.invitedList=[],t.tabChange=function(e){angular.forEach(t.displayStates,function(e,o){t.displayStates[o]=!1}),t.displayStates[e]=!0,e&&s.loadList()};var s={loadList:function(){a.getInvitedList({},function(e){"Y"==e.success&&(t.invitedList=e.data)},function(e){console.error(e)})}},i="/src/#/register";r&&(i+="?code="+r),t.qrcodeInfo={link:n.urlPrefix+i,v:5,e:"M",s:200}}]),angular.module("education").factory("ReferenceService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/inviterecord/lists",{},{getInvitedList:{method:"get",headers:{token:t.token}}})}]),angular.module("education").controller("RegisterController",["$rootScope","$scope","$state","$stateParams","RegisterService","LoginService","$timeout","CONFIG","ValidateService",function(e,t,o,a,n,r,s,i,c){function l(){return t.counts[h]=g[h],1==g[h]?(t.btnStates[h]=!1,g[h]=60,void s(p)):(g[h]--,void(p=s(l,1e3)))}var u=a.code,d={validateInput:function(o){return t.registerInfo[o].mobile?c.checkPhone(t.registerInfo[o].mobile)?t.registerInfo[o].smscode?c.checkSmsCode(t.registerInfo[o].smscode)?t.registerInfo[o].password?!!c.checkPwd(t.registerInfo[o].password)||(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请填写密码!"),!1):(e.showMessage("短信验证码格式不正确!"),!1):(e.showMessage("请填写短信验证码!"),!1):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("请填写手机号!"),!1)}},f=a.tabIndex,h=0,g=[60,60,60],p=null,m=["student","teacher","institution"];t.btnStates=[!1,!1,!1],t.counts=[g[0],g[1],g[2]],t.registerInfo={student:{type:m[0]},teacher:{type:m[1]},institution:{type:m[2]}},t.back=function(){o.go("login")},t.displayStates=[!0,!1,!1],t.tabChange=function(e){angular.forEach(t.displayStates,function(e,o){t.displayStates[o]=!1}),t.displayStates[e]=!0,h=e},f&&t.tabChange(f),t.submitRegisterInfo=function(){var a=m[h],r=d.validateInput(a);r&&(u&&(t.registerInfo[a].invitecode=u),n.register(t.registerInfo[a],function(t){if("Y"==t.success){i.token=t.data.token;var n=t.data.user;n.role=a,n.invite_code&&localStorage.setItem("code",n.invite_code),localStorage.setItem("token",t.data.token),localStorage.setItem("user",JSON.stringify(n)),i.user=n,e.user=n,e.showMessage("注册成功!"),s(function(){o.go("personal",null,{reload:!0})},1e3)}else if("N"==t.success)for(var r in t.msg)e.showMessage(t.msg[r])},function(t){e.showMessage("注册失败!")}))},t.getSmsCode=function(){return t.registerInfo[m[h]].mobile?c.checkPhone(t.registerInfo[m[h]].mobile)?(t.btnStates[h]=!0,void n.getSmsCode({mobile:t.registerInfo[m[h]].mobile},function(t){"Y"==t.success&&(l(),e.showMessage("验证码发送成功!"))},function(t){e.showMessage("验证码发送失败!"),console.log(t)})):(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("请填写手机号!"),!1)}}]),angular.module("education").factory("RegisterService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/regist",{},{register:{method:"post"},getSmsCode:{method:"post",url:t.urlPrefix+"/v1/account/sms"}})}]),angular.module("education").controller("SearchController",["$rootScope","$scope","$state","$stateParams","SearchService","TeacherService","$ionicPopup",function(e,t,o,a,n,r,s){t.type=a.type;var i=a.searchText;t.back=function(){t.type?o.go("studentOrderHardWare"):o.go("news")};var c={page:1};t.recommendList=[],t.teacherList=[],t.searchText="",t.showHistory=!0,t.histories=[];var l=/^[0-9]+$/,u={init:function(){t.showHistory&&u.getHistoryList()},loadList:function(){n.getRecommendTeacherList({},function(e){if("Y"==e.success){e.data.stars=[];for(var o=0;o<e.data.star;o++)e.data.stars.push(o);t.recommendList=e.data}},function(e){console.error(e)})},loadTeacherList:function(){var e=t.searchText;e&&(t.showHistory=!1,l.test(e)?c.mobile=e:c.truename=e,r.getTeacherList(c,function(o){if("Y"==o.success){t.histories.indexOf(e)==-1&&(t.histories.push(e),localStorage.setItem("records",t.histories)),o.data.stars=[];for(var a=0;a<o.data.star;a++)o.data.stars.push(a);t.teacherList=t.teacherList.concat(o.data),t.$broadcast("scroll.infiniteScrollComplete"),o.data.length>0?t.hasMoreData=!0:t.hasMoreData=!1}},function(e){console.log(e)}))},getHistoryList:function(){var e=localStorage.getItem("records");e&&(e.indexOf(",")!=-1?t.histories=e.split(","):t.histories.indexOf(e)==-1&&t.histories.push(e))}};i&&(t.showHistory=!1,t.searchText=i,u.loadTeacherList()),u.init(),t.search=function(){return t.searchText?(c={page:1},t.teacherList.length=0,void u.loadTeacherList()):void e.showMessage("搜索关键字不能为空!")},t.loadMore=function(){c.page++,u.loadTeacherList()},t.refresh=function(){c.page=1,t.teacherList.length=0,u.loadTeacherList()},t.textChange=function(){t.searchText||(t.showHistory=!0,u.getHistoryList())},t.clearHistory=function(){var e=s.confirm({template:"清空历史记录?",okText:"立即清空",okType:"button-energized",cancelText:"取消",cancelType:"button-dark"});e.then(function(e){e&&(localStorage.removeItem("records"),t.histories.length=0)})},t.setSearchText=function(e){t.searchText=e,t.search()},t.toStudentHardWare=function(e,t){e.preventDefault(),e.stopPropagation(),o.go("studentOrderHardWare",{id:t.id,name:t.truename})}}]),angular.module("education").factory("SearchService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/teacher/recommend",{},{getRecommendTeacherList:{method:"get"}})}]),angular.module("education").controller("ExamineController",["$rootScope","$scope","StaffService","$state","$stateParams",function(e,t,o,a,n){var r=n.tabIndex;t.showTeacherList=!0,t.showOrganizationList=!1,r&&(t.showTeacherList=!1,t.showOrganizationList=!0),t.back=function(){a.go("personal")},t.teacherList=[],t.organizationList=[];var s={loadTeacherList:function(){o.getTeacherList({},function(e){"Y"==e.success&&(t.teacherList=e.data)},function(e){console.log(e)})},loadOrganizationList:function(){o.getOrganizationList({},function(e){"Y"==e.success&&(t.organizationList=e.data)},function(e){console.log(e)})}};r?s.loadOrganizationList():s.loadTeacherList(),t.changeTab=function(e){e?(t.showTeacherList=!1,t.showOrganizationList=!0,s.loadOrganizationList()):(t.showTeacherList=!0,t.showOrganizationList=!1,s.loadTeacherList())}}]),angular.module("education").controller("StaffOrderController",["$rootScope","$scope","$state","$ionicPopup","StaffService","$stateParams",function(e,t,o,a,n,r){t.back=function(){o.go("personal")},t.displayStates=[!0,!1],r.tabIndex&&(t.displayStates=[!1,!0]),t.tabChange=function(e){angular.forEach(t.displayStates,function(e,o){t.displayStates[o]=!1}),t.displayStates[e]=!0,e?s.getServiceList():s.getEquipmentList()},t.showConfirm=function(e,o){if("待上门安装"==e.status){a.show({template:"硬件安装完成后<br/>请将状态更改为[已完成安装]<br/>如果客户取消安装<br/>请将状态更改为[客户取消]",title:"更改智能硬件上门安装状态",scope:t,buttons:[{text:"已完成安装",type:"button-energized",onTap:function(t){n.updateEquipmentStatus({id:e.id,status:2},function(e){"Y"==e.success&&s.getEquipmentList()},function(e){console.error(e)})}},{text:"客户取消",type:"button-energized",onTap:function(t){n.updateEquipmentStatus({id:e.id,status:3},function(e){"Y"==e.success&&s.getEquipmentList()},function(e){console.error(e)})}},{text:"关闭",type:"button-dark"}]})}};var s={getServiceList:function(){n.getServiceList({},function(e){"Y"==e.success&&(t.serviceList=e.data)},function(e){console.error(e)})},getEquipmentList:function(){n.getEquipmentList({},function(e){"Y"==e.success&&(t.equipmentList=e.data)},function(e){console.error(e)})}};r.tabIndex?s.getServiceList():s.getEquipmentList()}]),angular.module("education").controller("StaffOrderDetailsController",["$rootScope","$scope","$state","$ionicPopup","$stateParams","StaffService","$timeout",function(e,t,o,a,n,r,s){var i=n.tabIndex;t.back=function(){o.go("staffOrder",{tabIndex:i})},t.dispalyStates=[!0,!1,!1],t.tabChange=function(e){angular.forEach(t.dispalyStates,function(e,o){t.dispalyStates[o]=!1}),t.dispalyStates[e]=!0};var c={getOrderDetails:function(){r.getOrderDetails({id:n.id},function(e){if("Y"==e.success){var e=e.data;"1"==e.status?e.statusDisplay="待支付":"2"==e.status&&(e.statusDisplay="已支付"),t.orderInfo=e}})}};c.getOrderDetails(),t.confirm=function(){var t=a.confirm({title:"提示",template:"您确定已收款?",cancelText:"取消",cancelType:"button-dark",okText:"确定",okType:"button-energized"});t.then(function(t){t&&r.authOrder({id:n.id,status:2},function(t){"Y"==t.success&&(e.showMessage("收款成功!"),s(function(){o.go("staffOrder",{tabIndex:i})},1e3))})})}}]),angular.module("education").controller("StaffOrderServiceController",["$rootScope","$scope","$state","$ionicPopup","StaffService","$timeout","ValidateService",function(e,t,o,a,n,r,s){var i={getStaticFee:function(){n.getStaticFee({},function(e){"Y"==e.success&&(t.feeInfo=e.data)})}};i.getStaticFee(),t.getTeacherFee=function(){return t.serviceInfo.mobile?s.checkPhone(t.serviceInfo.mobile)?void n.getTeacherFee({mobile:t.serviceInfo.mobile},function(e){"Y"==e.success&&(t.teacherFee=parseFloat(e.data.extra_server_fee))}):void e.showMessage("手机号码格式不正确!"):void e.showMessage("手机号不能为空!")},t.back=function(){o.go("personal")},t.teacherFee=0,t.displayStates=[!0,!1],t.serviceInfo={manage_id:e.user.id,total_fee:0,status:1,equipment:1,homework_server:3,prepare_server:0,extra_server:0},t.createOrder=function(){return t.serviceInfo.mobile?s.checkPhone(t.serviceInfo.mobile)?void a.show({template:"1、智能硬件免费提供给使用者使用,采取押金方式提供;<br/>2、3个月内,硬件没有大的人为损害,使用者无条件自由退换押金;<br/>3、使用者长期使用期间,硬件产品的换代升级,提供新的硬件产品,为全免费置换模式;使用者无需另行支付或增加押金额;<br/>4、使用满1年后,使用者不再有硬件使用需求,在硬件产品没有大的人为损害情况下,且硬件产品具备使用条件,使用者可申请退换押金;<br/>5、智能硬件产品实行三年质保,终生保修(质保指由于质量缺陷造成的设备无法正常使用)过程中产生邮寄或路程费用由使用者承担。如因使用或保管不当原因导致产品出现以下情况，包括但不限于主板或芯片损坏、零部件损坏、烧坏、外观破损、人为损坏、或擅自拆装等现象，不属于质保范围;",title:"智能硬件产品质保及押金使用模式说明",cssClass:"service-popup",scope:t,buttons:[{text:"取消",type:"button-dark"},{text:"确认并同意协议",type:"button-energized",onTap:function(a){var s=t.serviceInfo,i=t.feeInfo;s.total_fee=i.equipment_fee*s.equipment+i.homework_fee*s.homework_server+i.prepare_fee*s.prepare_server+t.teacherFee*s.extra_server,n.orderService(t.serviceInfo,function(t){"Y"==t.success&&(e.showMessage("订单生成成功!"),r(function(){o.go("staffOrderDetails",{id:t.data.id})},1e3))})}}]}):void e.showMessage("手机号码格式不正确!"):void e.showMessage("手机号不能为空!")},t.changeFDYPrice=function(e){t.serviceInfo.equipment=e,e?t.displayStates=[!0,!1]:t.displayStates=[!1,!0]},t.changeZYPrice=function(o){var a=t.serviceInfo.homework_server;o?a+=o:a>3?a-=1:e.showMessage("不能少于3个月!"),t.serviceInfo.homework_server=a},t.changeFYPrice=function(o){var a=t.serviceInfo.prepare_server;o?a+=o:a>0?a-=1:e.showMessage("不能少于0个月!"),t.serviceInfo.prepare_server=a},t.changeBYPrice=function(o){var a=t.serviceInfo.extra_server;o?a+=o:a>0?a-=1:e.showMessage("不能少于0小时!"),t.serviceInfo.extra_server=a}}]),angular.module("education").controller("ExamineOrganizationController",["$rootScope","$scope","StaffService","$state","$stateParams","$ionicPopup","$timeout",function(e,t,o,a,n,r,s){var i=n.tabIndex;t.back=function(){a.go("examineList",{tabIndex:i})};var c={getDetails:function(){o.getOrganizationDetails({id:n.id},function(e){"Y"==e.success&&(t.organizationInfo=e.data)},function(e){console.error(e)})}};c.getDetails(),t.pass=function(){var t=r.confirm({title:"审核",template:"您确定通过审核？",okText:"确定",cancelText:"取消",okType:"button-energized",cancelType:"button-dark"});t.then(function(t){t&&o.authOrganization({id:n.id},function(t){"Y"==t.success&&(e.showMessage("审核成功!"),s(function(){a.go("examineList",{tabIndex:i})},1e3));
},function(t){e.showMessage("审核失败!")})})}}]),angular.module("education").factory("StaffService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/news/lists",{},{getNewsList:{method:"get"},getNewsDetails:{method:"get",url:t.urlPrefix+"/v1/news/detail/:id"},getTeacherList:{method:"get",url:t.urlPrefix+"/v1/teacher/unauth/lists",headers:{token:t.token}},getOrganizationList:{method:"get",url:t.urlPrefix+"/v1/institution/unauth/lists",headers:{token:t.token}},authTeacher:{method:"post",url:t.urlPrefix+"/v1/manage/auth/teacher",headers:{token:t.token}},authOrganization:{method:"post",url:t.urlPrefix+"/v1/manage/auth/institution",headers:{token:t.token}},getOrganizationDetails:{method:"get",url:t.urlPrefix+"/v1/institution/detail/:id",headers:{token:t.token}},orderService:{method:"post",url:t.urlPrefix+"/v1/order/server/add",headers:{token:t.token}},getServiceList:{method:"get",url:t.urlPrefix+"/v1/order/server/lists",headers:{token:t.token}},getEquipmentList:{method:"get",url:t.urlPrefix+"/v1/order/equipment/lists",headers:{token:t.token}},updateEquipmentStatus:{method:"post",url:t.urlPrefix+"/v1/order/equipment/auth",headers:{token:t.token}},getOrderDetails:{method:"get",url:t.urlPrefix+"/v1/order/server/detail",headers:{token:t.token}},getStaticFee:{method:"get",url:t.urlPrefix+"/v1/order/static/fee",headers:{token:t.token}},getTeacherFee:{method:"get",url:t.urlPrefix+"/v1/order/teacher/fee",headers:{token:t.token}},authOrder:{method:"post",url:t.urlPrefix+"/v1/order/server/auth",headers:{token:t.token}},updateAvatar:{url:t.urlPrefix+"/v1/account/update",method:"post",headers:{token:t.token}}})}]),angular.module("education").controller("ExamineTeacherController",["$rootScope","$scope","StaffService","$state","$stateParams","TeacherService","$ionicPopup","$timeout",function(e,t,o,a,n,r,s,i){t.back=function(){a.go("examineList")};var c={},l={},u={},d={getDetails:function(){r.getDetails({id:n.id},function(e){if("Y"==e.success){t.teacherInfo=e.data;var o=[];t.teacherInfo.grades&&angular.forEach(t.teacherInfo.grades,function(e){o.push(c[e])}),t.teacherInfo.grades=o.join("、");var a=[];t.teacherInfo.subjects&&angular.forEach(t.teacherInfo.subjects,function(e){a.push(l[e])}),t.teacherInfo.subjects=a.join("、"),t.teacherInfo.grades=o.join("、");var n=[];t.teacherInfo.work_time&&angular.forEach(t.teacherInfo.work_time,function(e){n.push(u[e])}),t.teacherInfo.work_time=n.join("、")}},function(e){console.error(e)})},getGrades:function(){r.getGrades({},function(e){"Y"==e.success&&(c=e.data)},function(e){console.error(e)})},getSubjects:function(){r.getSubjects({},function(e){"Y"==e.success&&(l=e.subjects)},function(e){console.error(e)})},getTimes:function(){r.getTimes({},function(e){"Y"==e.success&&(u=e.workTime)},function(e){console.error(e)})}};d.getGrades(),d.getSubjects(),d.getTimes(),d.getDetails(),t.pass=function(){var t=s.confirm({title:"审核",template:"您确定通过审核？",okText:"确定",cancelText:"取消",okType:"button-energized",cancelType:"button-dark"});t.then(function(t){t&&o.authTeacher({id:n.id},function(t){"Y"==t.success&&(e.showMessage("审核成功!"),i(function(){a.go("examineList")},1e3))},function(t){e.showMessage("审核失败!")})})}}]),angular.module("education").controller("StudentOrderController",["$rootScope","$scope","$state","StudentService",function(e,t,o,a){e.showHeaderBar=!1,t.back=function(){o.go("personal")};var n={getOrderList:function(){a.getOrderList({},function(e){"Y"==e.success&&(t.orderList=e.data)})}};n.getOrderList()}]),angular.module("education").controller("StudentOrderDetailsController",["$rootScope","$scope","$state","$stateParams","StudentService",function(e,t,o,a,n){t.back=function(){o.go("studentOrder")},t.dispalyStates=[!0,!1],t.tabChange=function(e){angular.forEach(t.dispalyStates,function(e,o){t.dispalyStates[o]=!1}),t.dispalyStates[e]=!0};var r={getOrderInfo:function(){n.getOrderDetails({id:a.id},function(e){if("Y"==e.success){var e=e.data;"1"==e.status?e.statusDisplay="待支付":"2"==e.status&&(e.statusDisplay="已支付"),t.orderInfo=e}})}};r.getOrderInfo()}]),angular.module("education").controller("StudentOrderHardWareController",["$rootScope","$scope","$state","StudentService","$stateParams","$timeout","ValidateService",function(e,t,o,a,n,r,s){t.back=function(){localStorage.removeItem("hardwareInfo"),o.go("personal")},t.hardwareInfo={recommend_type:1},t.displayStates=[!0,!1];var i=n.id;i&&(t.name=n.name,t.hardwareInfo.recommend_type=2,t.displayStates=[!1,!0]),t.saveOrder=function(){var n=l.validateInput();n&&(t.hardwareInfo.mobile||(t.hardwareInfo.mobile=parseInt(e.user.mobile)),t.hardwareInfo.address_id=t.city.id,t.hardwareInfo.member_type=e.user.role,i&&(t.hardwareInfo.teacher_id=i),a.orderHardWare(t.hardwareInfo,function(t){"Y"==t.success?(localStorage.removeItem("hardwareInfo"),e.showMessage("预定申请已受理,我们的工作人员将在您指定的日期电话联系您并上门为您安装智能硬件!",5e3),r(function(){o.go("personal")},3e3)):angular.forEach(t.msg,function(o,a){e.showMessage(t.msg[a])})},function(t){console.error(t),e.showMessage("预定失败!")}))};var c=[];t.provinces=[],t.cities=[];var l={getAddressList:function(){a.getAddressList({},function(e){if("Y"==e.success){c=e.data;var o="";angular.forEach(e.data,function(e,a){o!=e.province&&(t.provinces.push({key:e.province}),o=e.province)});var a=localStorage.getItem("hardwareInfo");a?(t.hardwareInfo=angular.fromJson(a),t.hardwareInfo.province&&angular.forEach(t.provinces,function(e,o){if(e.key==t.hardwareInfo.province.key)return void(t.province=t.provinces[o])}),t.changeProvince(t.province),t.hardwareInfo.city&&angular.forEach(t.cities,function(e,o){if(e.key==t.hardwareInfo.city.key)return void(t.city=t.cities[o])}),t.hardwareInfo.time&&(t.hardwareInfo.time=new Date(t.hardwareInfo.time))):(t.province={key:""},t.city={key:"",id:""})}},function(e){console.log(e)})},validateInput:function(){var o=t.hardwareInfo;return o.time?t.province.key?t.city.key?o.address_detail?s.checkAddress(o.address_detail)?o.link_name?s.checkName(o.link_name)?o.mobile&&!s.checkPhone(o.mobile)?(e.showMessage("电话号码格式不正确!"),!1):!(2==t.hardwareInfo.recommend_type&&!t.name)||(e.showMessage("所选老师不能为空!"),!1):(e.showMessage("联系人姓名2-7个中文字符!"),!1):(e.showMessage("联系人姓名不能为空!"),!1):(e.showMessage("地址5-30个字符!"),!1):(e.showMessage("上门安装地址不能为空!"),!1):(e.showMessage("城市不能为空!"),!1):(e.showMessage("省份不能为空!"),!1):(e.showMessage("日期不能为空!"),!1)}};l.getAddressList(),t.changeProvince=function(e){e&&(t.province=e,t.cities=[],angular.forEach(c,function(o){o.province==e.key&&t.cities.push({key:o.city,id:o.id})}))},t.changeCity=function(e){t.city=e},t.changeType=function(e){t.hardwareInfo.recommend_type=e,1==e?t.displayStates=[!0,!1]:(t.displayStates=[!1,!0],o.go("search",{type:"student"}),t.hardwareInfo.province=t.province,t.hardwareInfo.city=t.city,localStorage.setItem("hardwareInfo",JSON.stringify(t.hardwareInfo)))}}]),angular.module("education").controller("StudentInfoController",["$rootScope","$scope","$state","StudentService","$timeout","ValidateService","$timeout",function(e,t,o,a,n,r,n){t.back=function(){o.go("personal")},t.states=[],t.grades=[],t.saveInfo=function(){var r=s.validateInput();r&&a.updatePersonalInfo(t.personalInfo,function(t){"Y"==t.success&&(e.showMessage("保存成功!"),n(function(){o.go("personal")},1e3))},function(e){console.error(e)})},t.personalInfo={};var s={getPersonalInfo:function(){a.getPersonalInfo({},function(e){if("Y"==e.success){var e=e.data;e.age&&(e.age=parseInt(e.age)),t.personalInfo=e,t.personalInfo.state&&angular.forEach(t.personalInfo.state,function(e){angular.forEach(t.states,function(t){t.key==e&&(t.isSelected=!0)})})}},function(e){console.error(e)})},getStates:function(){a.getStates({},function(e){"Y"==e.success&&angular.forEach(e.data,function(e,o){t.states.push({key:o,val:e,isSelected:!1})})},function(e){console.error(e)})},getGrades:function(){a.getGrades({},function(e){"Y"==e.success&&angular.forEach(e.data,function(e,o){t.grades.push({key:o,val:e})})},function(e){console.error(e)})},validateInput:function(){return t.personalInfo.truename?r.checkName(t.personalInfo.truename)?t.personalInfo.age?t.personalInfo.age<8||t.personalInfo.age>20?(e.showMessage("年龄8-20岁!"),!1):!!t.personalInfo.school_name||(e.showMessage("学校不能为空!"),!1):(e.showMessage("年龄不能为空!"),!1):(e.showMessage("姓名2-7个中文字符!"),!1):(e.showMessage("姓名不能为空!"),!1)}};t.changeSex=function(e){t.personalInfo.sex=e},t.changeGrade=function(e){t.personalInfo.grade=e},t.changeState=function(e){var o=t.personalInfo.state;o||(o=[]);var a=o.indexOf(e.key);e.isSelected=!e.isSelected,a==-1&&e.isSelected?o.push(e.key):o.splice(a,1),t.personalInfo.state=o},s.getGrades(),s.getStates(),s.getPersonalInfo()}]),angular.module("education").factory("StudentService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/detail",{},{getPersonalInfo:{method:"get",headers:{token:t.token}},updatePersonalInfo:{method:"post",url:t.urlPrefix+"/v1/account/update",headers:{token:t.token}},getStates:{url:t.urlPrefix+"/v1/student/state",method:"get"},getGrades:{url:t.urlPrefix+"/v1/student/grades",method:"get"},getAddressList:{url:t.urlPrefix+"/v1/address/lists",method:"get"},orderHardWare:{url:t.urlPrefix+"/v1/order/equipment/add",method:"post",headers:{token:t.token}},hasHardWare:{url:t.urlPrefix+"/v1/order/equipment/has",method:"get",headers:{token:t.token}},getOrderList:{url:t.urlPrefix+"/v1/order/server/lists",method:"get",headers:{token:t.token}},getOrderDetails:{method:"get",url:t.urlPrefix+"/v1/order/server/detail",headers:{token:t.token}}})}]).factory("HardWareService",function(){var e={setTeaherInfo:function(e,t){this.teacherId=e,this.name=t},getTeacherInfo:function(){return{teacherId:this.teacherId,name:this.name}}};return e}),angular.module("education").controller("TeacherOrderHardWareController",["$rootScope","$scope","$state","$timeout","StudentService","ValidateService",function(e,t,o,a,n,r){t.back=function(){o.go("personal")},t.saveOrder=function(){var r=i.validateInput();r&&(t.hardwareInfo.mobile||(t.hardwareInfo.mobile=parseInt(e.user.mobile)),t.hardwareInfo.address_id=t.city.id,t.hardwareInfo.member_type=e.user.role,n.orderHardWare(t.hardwareInfo,function(t){"Y"==t.success?(e.showMessage("预定申请已受理,我们的工作人员将在您指定的日期电话联系您并上门为您安装智能硬件!",5e3),a(function(){o.go("personal")},3e3)):angular.forEach(t.msg,function(o,a){e.showMessage(t.msg[a])})},function(t){console.error(t),e.showMessage("预定失败!")}))},t.hardwareInfo={recommend_type:1},t.city={key:"",id:""},t.province={key:""};var s=[];t.provinces=[],t.cities=[];var i={getAddressList:function(){n.getAddressList({},function(e){if("Y"==e.success){s=e.data;var o="";angular.forEach(e.data,function(e,a){o!=e.province&&(t.provinces.push({key:e.province}),o=e.province)})}},function(e){console.log(e)})},validateInput:function(){var o=t.hardwareInfo;return o.time?t.province.key?t.city.key?o.address_detail?r.checkAddress(o.address_detail)?o.link_name?r.checkName(o.link_name)?!(o.mobile&&!r.checkPhone(o.mobile))||(e.showMessage("手机号码格式不正确!"),!1):(e.showMessage("联系人姓名2-7位中文字符!"),!1):(e.showMessage("联系人姓名不能为空!"),!1):(e.showMessage("地址5-30个字符!"),!1):(e.showMessage("上门安装地址不能为空!"),!1):(e.showMessage("城市不能为空!"),!1):(e.showMessage("省份不能为空!"),!1):(e.showMessage("日期不能为空!"),!1)}};i.getAddressList(),t.changeProvince=function(e){t.province=e,t.cities=[],angular.forEach(s,function(o){o.province==e.key&&t.cities.push({key:o.city,id:o.id})})},t.changeCity=function(e){t.city=e}}]),angular.module("education").controller("TeacherController",["$rootScope","$scope","TeacherService","$stateParams","$state",function(e,t,o,a,n){t.back=function(){n.go("news")},t.teacherList=[],t.subjects=[],t.subject={key:""},t.schoolworks=[],t.schoolwork={key:""},t.grades=[],t.grade={key:""},t.hasMoreData=!0;var r={page:1},s={init:function(){s.getSchoolworks(),s.getGrades(),s.getSubjects(),s.loadList({page:r.page})},loadList:function(){o.getTeacherList(r,function(e){if("Y"==e.success){e.data.stars=[];for(var o=0;o<e.data.star;o++)e.data.stars.push(o);t.teacherList=t.teacherList.concat(e.data),t.$broadcast("scroll.infiniteScrollComplete"),e.data.length>0?t.hasMoreData=!0:t.hasMoreData=!1}},function(e){console.log(e)})},getSubjects:function(){o.getSubjects({},function(e){"Y"==e.success&&angular.forEach(e.subjects,function(e,o){t.subjects.push({key:o,val:e})})},function(e){console.log(e)})},getSchoolworks:function(){o.getSchoolworks({},function(e){"Y"==e.success&&angular.forEach(e.schoolwork,function(e,o){t.schoolworks.push({key:o,val:e})})},function(e){console.log(e)})},getGrades:function(){o.getGrades({},function(e){"Y"==e.success&&angular.forEach(e.data,function(e,o){t.grades.push({key:o,val:e})})},function(e){console.log(e)})}};s.init(),t.loadMore=function(){r.page++,s.loadList()},t.refresh=function(){r.page=1,t.teacherList.length=0,s.loadList()},t.changeGrade=function(e){r.page=1,t.teacherList.length=0,e?r.grade=e.key:r.grade="",s.loadList()},t.changeSubject=function(e){r.page=1,t.teacherList.length=0,e?r.subject=e.key:r.subject="",s.loadList()},t.changeSchoolwork=function(e){r.page=1,t.teacherList.length=0,e?r.schoolwork=e.key:r.schoolwork="",s.loadList()}}]),angular.module("education").controller("TeacherDetailsController",["$rootScope","$scope","$state","TeacherService","$stateParams",function(e,t,o,a,n){t.type=n.type;var r=n.searchText;t.back=function(){r?o.go("search",{type:t.type,searchText:r}):o.go("teacher")},t.teacherInfo={};var s={getDetails:function(){a.getDetails({id:n.id},function(e){if("Y"==e.success){t.teacherInfo=e.data,t.teacherInfo.stars=[];for(var o=0;o<e.data.star;o++)t.teacherInfo.stars.push(o)}},function(e){console.error(e)})}};s.getDetails(),t.sure=function(){var e=t.teacherInfo;o.go("studentOrderHardWare",{id:e.id,name:e.truename})},t.cancel=function(){o.go("search",{type:t.type,searchText:r})}}]),angular.module("education").controller("TeacherInfoController",["$rootScope","$scope","$state","TeacherService","Upload","$stateParams","CONFIG","$timeout","ValidateService","$ionicLoading",function(e,t,o,a,n,r,s,i,c,l){t.appTitle="我的资料",r.id&&(t.appTitle="机构教师资料编辑"),t.back=function(){r.id?o.go("organizationManager"):o.go("personal")},t.dispalyStates=[!0,!1,!1],t.grades=[],t.worktimes=[],t.subjects=[],t.saveInfo=function(){var n=u.validateInput();n&&a.updatePersonalInfo(t.personalInfo,function(t){"Y"==t.success&&(e.showMessage("保存成功!"),i(function(){o.go("personal")},1e3))},function(e){console.error(e)})},t.personalInfo={};var u={getTeacherInfo:function(){var e=this;a.getDetails({id:r.id},function(o){"Y"==o.success&&(t.personalInfo=o.data,e.handleTeacherInfo(t.personalInfo))},function(e){console.error(e)})},getPersonalInfo:function(){var e=this;a.getPersonalInfo({},function(o){"Y"==o.success&&(t.personalInfo=o.data,e.handleTeacherInfo(t.personalInfo))},function(e){console.error(e)})},handleTeacherInfo:function(e){var o=this;e.bankcard&&(e.bankcard=Number(e.bankcard)),e.age&&(e.age=Number(e.age)),e.worked_year&&(e.worked_year=Number(e.worked_year)),e.extra_server_fee&&(e.extra_server_fee=parseFloat(e.extra_server_fee)),e.certificate_url&&(t.f={},t.f.progress=100),o.setGrades(e.grades),o.setSubjects(e.subjects),o.setTimes(e.work_time)},getGrades:function(){a.getGrades({},function(e){"Y"==e.success&&angular.forEach(e.data,function(e,o){t.grades.push({key:o,val:e,isSelected:!1})})},function(e){console.error(e)})},getTimes:function(){a.getTimes({},function(e){"Y"==e.success&&angular.forEach(e.workTime,function(e,o){t.worktimes.push({key:o,val:e,isSelected:!1})})},function(e){console.error(e)})},getSubjects:function(){a.getSubjects({},function(e){"Y"==e.success&&angular.forEach(e.subjects,function(e,o){t.subjects.push({key:o,val:e,isSelected:!1})})},function(e){console.error(e)})},setGrades:function(e){e&&angular.forEach(e,function(e){angular.forEach(t.grades,function(t){t.key==e&&(t.isSelected=!0)})})},setSubjects:function(e){e&&angular.forEach(e,function(e){angular.forEach(t.subjects,function(t){t.key==e&&(t.isSelected=!0)})})},setTimes:function(e){e&&angular.forEach(e,function(e){angular.forEach(t.worktimes,function(t){t.key==e&&(t.isSelected=!0)})})},validateInput:function(){return t.personalInfo.truename?c.checkName(t.personalInfo.truename)?t.personalInfo.certificate_url?t.personalInfo.age?!(t.personalInfo.age<20||t.personalInfo.age>60)||(e.showMessage("年龄20-60!"),!1):(e.showMessage("年龄不能为空!"),!1):(e.showMessage("请上传本人身份证或教职资质照片!"),!1):(e.showMessage("姓名2-7个字符!"),!1):(e.showMessage("姓名不能为空!"),!1)}};t.changeSex=function(e){t.personalInfo.sex=e},t.changeGrade=function(e){angular.isArray(t.personalInfo.grades)||(t.personalInfo.grades=[]);var o=t.personalInfo.grades.indexOf(e.key),a=t.personalInfo.grades;e.isSelected=!e.isSelected,a||(a=[]),o==-1&&e.isSelected?a.push(e.key):a.splice(o,1)},t.changeSubject=function(e){angular.isArray(t.personalInfo.subjects)||(t.personalInfo.subjects=[]);var o=t.personalInfo.subjects.indexOf(e.key),a=t.personalInfo.subjects;e.isSelected=!e.isSelected,a||(a=[]),o==-1&&e.isSelected?a.push(e.key):a.splice(o,1)},t.changeTime=function(e){angular.isArray(t.personalInfo.work_time)||(t.personalInfo.work_time=[]);var o=t.personalInfo.work_time.indexOf(e.key),a=t.personalInfo.work_time;e.isSelected=!e.isSelected,a||(a=[]),o==-1&&e.isSelected?a.push(e.key):a.splice(o,1)},u.getGrades(),u.getTimes(),u.getSubjects(),r.id?u.getTeacherInfo():u.getPersonalInfo(),t.tabChange=function(e){angular.forEach(t.dispalyStates,function(e,o){t.dispalyStates[o]=!1}),t.dispalyStates[e]=!0},t.uploadFiles=function(o,a){t.f=o,t.errFile=a&&a[0],o&&(l.show({template:'<ion-spinner icon="ios-small"></ion-spinner>上传中...'}),o.upload=n.upload({url:s.urlPrefix+"/v1/common/upload",data:{file:o}}),o.upload.then(function(o){l.hide(),i(function(){t.personalInfo.certificate_url=o.data,e.showMessage("上传成功!")})},function(o){o.status>0&&(t.errorMsg=o.status+": "+o.data,l.hide(),e.showMessage("上传失败!"))},function(e){o.progress=Math.min(100,parseInt(100*e.loaded/e.total))}))}}]),angular.module("education").factory("TeacherService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/detail",{},{getPersonalInfo:{method:"get",headers:{token:t.token}},updatePersonalInfo:{method:"post",url:t.urlPrefix+"/v1/teacher/update",headers:{token:t.token}},getTimes:{url:t.urlPrefix+"/v1/common/teacher/worktime",method:"get"},getGrades:{url:t.urlPrefix+"/v1/student/grades",method:"get"},getSubjects:{url:t.urlPrefix+"/v1/common/subjects",method:"get"},getSchoolworks:{url:t.urlPrefix+"/v1/common/schoolwork",method:"get"},getTeacherList:{url:t.urlPrefix+"/v1/teacher/lists",method:"get"},getDetails:{url:t.urlPrefix+"/v1/teacher/detail/:id",method:"get",headers:{token:t.token}},getRecommendTeacherList:{url:t.urlPrefix+"/v1/teacher/recommend",method:"get"}})}]),angular.module("education").controller("UpdatepwdController",["$rootScope","$scope","$state","UpdatepwdService","$timeout","ValidateService",function(e,t,o,a,n,r){e.showHeaderBar=!1,t.pwdInfo={},t.back=function(){o.go("personal")};var s={validateInput:function(){var o=t.pwdInfo;return o.password?r.checkPwd(o.password)?o.pwd1?r.checkPwd(o.pwd1)?o.pwd2?r.checkPwd(o.pwd2)?o.pwd1==o.pwd2||(e.showMessage("两次输入的密码不一致,请重新输入!"),!1):(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请设置新密码!"),!1):(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请输入新密码!"),!1):(e.showMessage("密码必须是6-10位字母、数字组合!"),!1):(e.showMessage("请输入原密码!"),!1)}};t.updatePwd=function(){var r=s.validateInput();if(r){var i={password:t.pwdInfo.password,newpassword:t.pwdInfo.pwd2};a.updatePwd(i,function(t){"Y"==t.success?(e.showMessage("修改成功!"),n(function(){o.go("personal")},1e3)):angular.isObject(t.msg)?angular.forEach(t.msg,function(t,o){e.showMessage(t)}):e.showMessage(t.msg)},function(t){console.error(t),e.showMessage("修改失败!")})}}}]),angular.module("education").factory("UpdatepwdService",["$resource","CONFIG",function(e,t){return e(t.urlPrefix+"/v1/account/updatepassword",{},{updatePwd:{method:"post",headers:{token:t.token}}})}]);